import{r as b}from"./vendor-BHBgCXd7.js";import{s as L}from"./startOfWeek-Bny05VrO.js";import{e as P}from"./endOfWeek-B_3EXgRf.js";import{t as T}from"./toDate-BKXxHYqX.js";function W(l,n,a){const p=+T(l,a?.in),[h,s]=[+T(n.start,a?.in),+T(n.end,a?.in)].sort((f,w)=>f-w);return p>=h&&p<=s}const Z=(l,n,a,p=[])=>b.useMemo(()=>{if(!l||!n||!a)return{totalHours:0,activeModules:0,pendingTasks:0,weeklyProgress:0,moduleData:[],weeklyTrend:[],streak:0};const h=(p||[]).map(e=>({...e,hours:e.duration||0,date:e.completedAt,type:"focus"})),s=[...l,...h],f=s.reduce((e,t)=>e+parseFloat(t.hours||0),0),w=new Date().toISOString().split("T")[0],H=s.filter(e=>(e.date||e.createdAt)?.split("T")[0]===w).reduce((e,t)=>e+parseFloat(t.hours||0),0),k=n.length,A=a.filter(e=>e.status==="Pending").length,y=n.map((e,t)=>{const u=s.filter(D=>D.moduleId===e.id).reduce((D,x)=>D+parseFloat(x.hours||0),0),r=parseFloat(e.totalHoursStudied||0)+u,c=parseFloat(e.targetHours||0),S=Math.max(0,c-r);return{id:e.id,name:e.name,hours:r,remaining:S.toFixed(1),target:c,progress:c>0?r/c*100:0,index:t}}),I=y.reduce((e,t)=>e+parseFloat(t.remaining),0),F=new Date,E=L(F),M=P(F),O=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"].map((e,t)=>{const i=s.filter(o=>{const r=o.date?new Date(o.date):o.createdAt?new Date(o.createdAt):null;return r&&r.getDay()===t&&W(r,{start:E,end:M})}),u={};return n.forEach(o=>{const r=i.filter(c=>c.moduleId===o.id).reduce((c,S)=>c+parseFloat(S.hours||0),0);r>0&&(u[o.id]=r)}),{day:e,hours:i.reduce((o,r)=>o+parseFloat(r.hours||0),0),moduleHours:u}}),d=[...new Set(s.map(e=>{const t=e.date||e.createdAt;return t?new Date(t).toISOString().split("T")[0]:null}))].filter(Boolean).sort().reverse();let m=0;if(d.length>0){const e=new Date().toISOString().split("T")[0],t=new Date(Date.now()-864e5).toISOString().split("T")[0];if(d[0]===e||d[0]===t){m=1;for(let i=0;i<d.length-1;i++){const u=new Date(d[i]),o=new Date(d[i+1]);if((u-o)/(1e3*60*60*24)===1)m++;else break}}}const g=[];return m>=3&&g.push({name:"Persistence",icon:"Flame",color:"purple"}),f>=10&&g.push({name:"Scholar",icon:"Target",color:"gold"}),a.filter(e=>e.status==="Completed").length>=5&&g.push({name:"Focus King",icon:"Award",color:"green"}),s.some(e=>{const t=e.date?new Date(e.date):null;return t&&t.getHours()<8})&&g.push({name:"Early Bird",icon:"Zap",color:"primary"}),{totalHours:f,todayHours:H,totalRemaining:I,activeModules:k,pendingTasks:A,weeklyProgress:n.length>0?y.reduce((e,t)=>e+t.progress,0)/n.length:0,moduleData:y,weeklyTrend:O,streak:m,badges:g}},[l,n,a,p]);export{Z as u};
