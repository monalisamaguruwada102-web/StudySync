import{r as d,j as e,m as F}from"./vendor-BHBgCXd7.js";import{L as z}from"./Layout-BW6pkOKI.js";import{C as D}from"./Card-FPDh96Dz.js";import{B as l}from"./Button-Cg-uFP-H.js";import{I as o}from"./Input-Bxxkotjn.js";import{M as O}from"./Modal-DoZe7KXC.js";import{u as c}from"./useFirestore-BslRrM8B.js";import{m as u,f as v,c as $,p as G,t as L,s as T}from"./index-DJ53ofb6.js";import{u as E}from"./useAnalytics-C4G8BC_B.js";import{a as P}from"./aiService-DmK4mU--.js";import{P as B,f as y,s as R,W as q,t as W,u as U,k as J}from"./icons-BEGX_Ie2.js";import"./startOfWeek-Bny05VrO.js";import"./toDate-BKXxHYqX.js";import"./endOfWeek-B_3EXgRf.js";const de=()=>{const{data:x,loading:b,refresh:p}=c(u.getAll),{data:N}=c(T.getAll),{data:k}=c(L.getAll),{data:w}=c(G.getAll),[S,i]=d.useState(!1),[n,h]=d.useState(null),C=E(N,x,k,w),[a,r]=d.useState({name:"",description:"",targetHours:"",totalHoursStudied:""}),[m,g]=d.useState(null),f=(t=null)=>{t?(h(t),r({name:t.name,description:t.description,targetHours:t.targetHours,totalHoursStudied:t.totalHoursStudied||0})):(h(null),r({name:"",description:"",targetHours:"",totalHoursStudied:""})),i(!0)},A=async t=>{t.preventDefault();const s={...a,targetHours:parseFloat(a.targetHours)||0,totalHoursStudied:parseFloat(a.totalHoursStudied)||0};n?await u.update(n.id,s):await u.add(s),await p(),i(!1)},H=async t=>{window.confirm("Are you sure you want to delete this module? All associated data will be affected.")&&(await u.delete(t),await p())},M=async t=>{g(t.id);try{const s=await P.generateFlashcards(t.name,t.description),K=await v.getAll(j=>{}),I=await v.add({name:`AI: ${t.name}`,moduleId:t.id,description:`Auto-generated flashcards for ${t.name}`});for(const j of s)await $.add({...j,deckId:I.id});alert(`âœ¨ Successfully generated ${s.length} flashcards for ${t.name}! Check your Flashcards page.`)}catch(s){console.error("AI Generation failed:",s),alert("AI generation failed. Please try again.")}finally{g(null)}};return e.jsxs(z,{title:"Module Management",children:[e.jsxs("div",{className:"flex justify-between items-center mb-8",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-slate-900 dark:text-slate-100",children:"Academic Modules"}),e.jsx("p",{className:"text-slate-500 dark:text-slate-400",children:"Track and manage your study modules and targets."})]}),e.jsxs(l,{onClick:()=>f(),className:"flex items-center gap-2",children:[e.jsx(B,{size:20}),e.jsx("span",{children:"Add Module"})]})]}),b?e.jsx("div",{className:"text-center py-12 text-slate-400",children:"Loading modules..."}):e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[C.moduleData.map(t=>{const s=t.progress.toFixed(0);return e.jsxs(D,{className:"group relative overflow-hidden transition-all hover:shadow-lg hover:border-primary-100",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsx("div",{className:"w-12 h-12 bg-primary-50 dark:bg-primary-900/20 rounded-xl flex items-center justify-center text-primary-600 dark:text-primary-400",children:e.jsx(y,{size:24})}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx(l,{variant:"ghost",onClick:()=>M(t),className:`!p-2 ${m===t.id?"text-primary-500 animate-pulse":"text-slate-400 hover:text-primary-500"}`,disabled:m!==null,title:"Generate AI Flashcards",children:m===t.id?e.jsx(R,{className:"animate-spin",size:16}):e.jsx(q,{size:16})}),e.jsx(l,{variant:"ghost",onClick:()=>f(t),className:"!p-2 text-slate-400 hover:text-primary-600",children:e.jsx(W,{size:16})}),e.jsx(l,{variant:"ghost",onClick:()=>H(t.id),className:"!p-2 text-slate-400 hover:text-red-500",children:e.jsx(U,{size:16})})]})]}),e.jsx("h3",{className:"text-lg font-bold text-slate-800 dark:text-slate-100 mb-1",children:t.name}),e.jsx("div",{className:"flex justify-between items-start mb-4",children:e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400 line-clamp-2 h-10",children:t.description||"No description provided"})}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-end",children:[e.jsxs("div",{className:"flex flex-col gap-0.5",children:[e.jsxs("div",{className:"flex items-center gap-2 text-primary-600 dark:text-primary-400 font-bold text-xs uppercase tracking-wider",children:[e.jsx(J,{size:14}),e.jsxs("span",{children:[t.remaining,"h Remaining"]})]}),e.jsxs("span",{className:"text-[10px] text-slate-400 font-medium",children:[t.hours.toFixed(1),"h / ",t.target,"h Total"]})]}),e.jsxs("span",{className:"text-sm font-black text-slate-800 dark:text-slate-200",children:[s,"%"]})]}),e.jsx("div",{className:"h-2 bg-slate-100 dark:bg-slate-800/50 rounded-full overflow-hidden border border-slate-200/50 dark:border-white/5",children:e.jsx(F.div,{initial:{width:0},animate:{width:`${s}%`},className:"h-full bg-gradient-to-r from-primary-500 to-indigo-500 rounded-full",transition:{duration:1,ease:"easeOut"}})})]})]},t.id)}),x.length===0&&e.jsxs("div",{className:"col-span-full text-center py-20 bg-slate-50 rounded-2xl border-2 border-dashed border-slate-200",children:[e.jsx(y,{size:48,className:"mx-auto text-slate-300 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-slate-600",children:"No modules yet"}),e.jsx("p",{className:"text-slate-400",children:'Click "Add Module" to start tracking your subjects.'})]})]}),e.jsx(O,{isOpen:S,onClose:()=>i(!1),title:n?"Edit Module":"Create New Module",footer:e.jsxs(e.Fragment,{children:[e.jsx(l,{variant:"secondary",onClick:()=>i(!1),children:"Cancel"}),e.jsx(l,{variant:"primary",onClick:A,children:n?"Update Module":"Create Module"})]}),children:e.jsxs("form",{className:"space-y-4",children:[e.jsx(o,{label:"Module Name",placeholder:"e.g. Data Structures & Algorithms",value:a.name,onChange:t=>r({...a,name:t.target.value}),required:!0}),e.jsx(o,{label:"Description",placeholder:"Short overview of the module",value:a.description,onChange:t=>r({...a,description:t.target.value})}),e.jsx(o,{label:"Target Hours",type:"number",placeholder:"e.g. 50",value:a.targetHours,onChange:t=>r({...a,targetHours:t.target.value}),required:!0}),e.jsx(o,{label:"Current Studied Hours (Legacy/Existing)",type:"number",placeholder:"e.g. 10",value:a.totalHoursStudied,onChange:t=>r({...a,totalHoursStudied:t.target.value})})]})})]})};export{de as default};
