import{j as e,r as n,R as G,A as D,m as E}from"./vendor-BHBgCXd7.js";import{L as F}from"./Layout-B83BWzRM.js";import{C as h}from"./Card-FPDh96Dz.js";import{a as B,u as H,b as u}from"./index-Bt0XpbVC.js";import{a8 as P,a9 as K,aa as W,i as J,ab as N,O as z,x as A,k as X,ac as Y,r as I,ad as _,D as q,s as R,ae as Q,af as O}from"./icons-BEGX_Ie2.js";import"./Button-Cg-uFP-H.js";import"./useFirestore-BslRrM8B.js";const V=[{id:"default",name:"Default",colors:["#3b82f6","#ec4899"]},{id:"midnight",name:"Midnight",colors:["#6366f1","#a855f7"]},{id:"forest",name:"Forest",colors:["#10b981","#14b8a6"]},{id:"sunset",name:"Sunset",colors:["#f97316","#f43f5e"]},{id:"ocean",name:"Ocean",colors:["#0ea5e9","#06b6d4"]},{id:"cyberpunk",name:"Cyberpunk",colors:["#a855f7","#f0f"]},{id:"rose",name:"Rose",colors:["#f43f5e","#fbbf24"]}],Z=()=>{const{theme:i,isDarkMode:o,toggleTheme:b,toggleDarkMode:c}=B();return e.jsxs("div",{className:"p-4 bg-[var(--card-bg)] border border-[var(--card-border)] rounded-xl shadow-lg space-y-6 w-full max-w-xs",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"text-lg font-bold flex items-center gap-2",children:[e.jsx(P,{size:20,className:"text-primary-500"}),"Appearance"]}),e.jsx("button",{onClick:c,className:"p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors",title:o?"Switch to Light Mode":"Switch to Dark Mode",children:o?e.jsx(K,{size:20,className:"text-yellow-400"}):e.jsx(W,{size:20,className:"text-primary-600"})})]}),e.jsx("div",{className:"grid grid-cols-2 gap-3",children:V.map(l=>e.jsxs("button",{onClick:()=>b(l.id),className:`group relative p-3 rounded-xl border-2 transition-all duration-300 text-left ${i===l.id?"border-primary-500 bg-primary-50 dark:bg-primary-900/20":"border-transparent bg-gray-50 dark:bg-gray-800/50 hover:border-primary-300"}`,children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("span",{className:`text-sm font-semibold ${i===l.id?"text-primary-600":"text-gray-600 dark:text-gray-400"}`,children:l.name}),e.jsx("div",{className:"flex gap-1",children:l.colors.map((y,x)=>e.jsx("div",{className:"w-4 h-4 rounded-full",style:{backgroundColor:y}},x))})]}),i===l.id&&e.jsx("div",{className:"absolute top-2 right-2 text-primary-500",children:e.jsx(J,{size:16})})]},l.id))})]})},ie=()=>{const{user:i}=H();console.debug("Settings: user state:",i);const[o,b]=n.useState(!1),[c,l]=n.useState(!1),[y,x]=n.useState(null),[d,L]=n.useState("general"),[p,k]=n.useState(""),[m,v]=n.useState(""),[w,S]=n.useState(""),[U,C]=n.useState(!1),[t,f]=n.useState({type:"",message:"",loading:!1});G.useEffect(()=>{(async()=>{try{const s=await u.get("/user/settings");k(s.data.calendar_sync_url||""),v(s.data.notion_api_token||""),S(s.data.notion_database_id||""),C(s.data.auto_sync_calendar||!1)}catch(s){console.error("Failed to fetch user settings:",s)}})()},[]);const T=async a=>{f({type:a,message:"Testing...",loading:!0});try{const s=a==="calendar"?"/sync/test-calendar":"/sync/test-notion",r=a==="calendar"?{url:p}:{token:m,databaseId:w},j=await u.post(s,r);f({type:a,message:j.data.message,loading:!1})}catch(s){f({type:a,message:s.response?.data?.error||"Connection failed",loading:!1})}},g=async(a,s)=>{try{await u.post("/user/settings",{[a]:s})}catch(r){console.error("Failed to save user setting:",r)}},$=async()=>{b(!0);try{const a=await u.get("/admin/export",{responseType:"blob"}),s=window.URL.createObjectURL(new Blob([a.data])),r=document.createElement("a");r.href=s,r.setAttribute("download",`StudySync-Backup-${new Date().toISOString().split("T")[0]}.json`),document.body.appendChild(r),r.click(),r.remove()}catch(a){console.error("Export failed:",a),alert("Export failed. Please try again.")}finally{b(!1)}},M=async a=>{const s=a.target.files[0];if(!s)return;if(!window.confirm("WARNING: This will overwrite your current database. Are you sure?")){a.target.value=null;return}l(!0),x("pending");const r=new FormData;r.append("file",s);try{await u.post("/admin/import",r,{headers:{"Content-Type":"multipart/form-data"}}),x("success"),setTimeout(()=>window.location.reload(),2e3)}catch(j){x("error"),console.error("Import failed:",j)}finally{l(!1),a.target.value=null}};return e.jsx(F,{title:"Settings & Security",children:e.jsxs("div",{className:"max-w-4xl mx-auto space-y-8",children:[e.jsx("div",{className:"flex items-center gap-2 p-1 bg-white/50 dark:bg-slate-800/50 backdrop-blur-md rounded-2xl border border-white/20 dark:border-slate-800 w-full overflow-x-auto no-scrollbar",children:[{id:"general",label:"General",icon:N},{id:"appearance",label:"Appearance",icon:P},{id:"integrations",label:"Integrations",icon:z},{id:"system",label:"System",icon:A}].map(a=>e.jsxs("button",{onClick:()=>L(a.id),className:`flex items-center gap-2 px-6 py-2.5 rounded-xl text-sm font-black transition-all whitespace-nowrap ${d===a.id?"bg-primary-500 text-white shadow-lg shadow-primary-500/20":"text-slate-500 dark:text-slate-400 hover:bg-white/10"}`,children:[e.jsx(a.icon,{size:16}),a.label]},a.id))}),e.jsx(D,{mode:"wait",children:e.jsxs(E.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{duration:.2},className:"space-y-8",children:[d==="general"&&e.jsx(h,{title:"General Preferences",HeaderAction:e.jsx(N,{size:18,className:"text-primary-500"}),children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"p-4 bg-primary-500/5 border border-primary-500/10 rounded-2xl",children:[e.jsx("h4",{className:"text-sm font-black text-primary-500 uppercase tracking-widest mb-1",children:"Study Goals"}),e.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400",children:"Set your daily study objectives."})]}),e.jsxs("div",{className:"flex items-center justify-between p-4 rounded-2xl bg-slate-50 dark:bg-slate-800/50 border border-slate-100 dark:border-slate-800/50",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-3 rounded-xl bg-primary-500/20 text-primary-500",children:e.jsx(X,{size:20})}),e.jsxs("div",{children:[e.jsx("h5",{className:"text-sm font-black text-slate-800 dark:text-slate-100 uppercase tracking-wider",children:"Daily Target (Hours)"}),e.jsx("p",{className:"text-xs text-slate-400 font-bold uppercase tracking-widest",children:"Averages 2h per day"})]})]}),e.jsx("input",{type:"number",step:"0.5",className:"w-20 bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-700 rounded-lg px-2 py-1 text-center font-bold outline-none focus:ring-2 focus:ring-primary-500/20",value:i?.settings?.dailyStudyTarget||2,onChange:a=>g("dailyStudyTarget",parseFloat(a.target.value))})]})]})}),d==="appearance"&&e.jsx("div",{className:"space-y-6",children:e.jsx(Z,{})}),d==="integrations"&&e.jsx("div",{className:"space-y-6",children:e.jsx(h,{title:"External Connections",HeaderAction:e.jsx(z,{size:18,className:"text-indigo-500"}),children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 rounded-3xl bg-white dark:bg-slate-900 border border-slate-100 dark:border-slate-800",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-4 bg-green-500 text-white rounded-2xl shadow-lg shadow-green-500/20",children:e.jsx(Y,{size:24})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-black text-slate-900 dark:text-white uppercase tracking-wider",children:"Spotify & Lofi"}),e.jsx("p",{className:"text-xs text-slate-500 font-bold uppercase tracking-widest",children:"In-App Study Beats"})]})]}),e.jsx("div",{className:"px-4 py-1.5 bg-green-500/10 text-green-500 rounded-full text-[10px] font-black uppercase tracking-widest border border-green-500/20",children:"Connected"})]}),e.jsxs("div",{className:"p-6 rounded-3xl bg-white dark:bg-slate-900 border border-slate-100 dark:border-slate-800 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-4 bg-blue-500 text-white rounded-2xl",children:e.jsx(I,{size:24})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-black text-slate-900 dark:text-white uppercase tracking-wider",children:"Google Calendar"}),e.jsx("p",{className:"text-xs text-slate-500 font-bold uppercase tracking-widest",children:"Schedule Sync (iCal)"})]})]}),e.jsx("div",{className:`px-4 py-1.5 rounded-full text-[10px] font-black uppercase tracking-widest border transition-all ${p?"bg-green-500/10 text-green-500 border-green-500/20":"bg-slate-500/10 text-slate-500 border-slate-500/20"}`,children:p?"Configured":"Not Connected"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",placeholder:"Paste Public iCal URL (e.g. from Google Settings)",value:p,onChange:a=>{const s=a.target.value;k(s),g("calendar_sync_url",s)},className:"flex-1 bg-slate-50 dark:bg-slate-800 border border-slate-100 dark:border-slate-700 rounded-xl px-4 py-2 text-xs outline-none focus:ring-2 focus:ring-primary-500/20"}),e.jsx("button",{onClick:()=>T("calendar"),disabled:t.loading||!p,className:"px-4 py-2 bg-primary-500/10 text-primary-500 hover:bg-primary-500 hover:text-white rounded-xl text-xs font-black transition-all disabled:opacity-50",children:t.loading&&t.type==="calendar"?"...":"TEST"})]}),t.type==="calendar"&&e.jsx("p",{className:`text-[10px] font-bold ${t.message.includes("Success")?"text-green-500":"text-red-500"}`,children:t.message}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsx("input",{type:"checkbox",id:"autoSync",checked:U,onChange:a=>{const s=a.target.checked;C(s),g("auto_sync_calendar",s)},className:"w-4 h-4 rounded border-slate-300 text-primary-600 focus:ring-primary-500"}),e.jsx("label",{htmlFor:"autoSync",className:"text-xs text-slate-500 font-bold uppercase tracking-widest cursor-pointer",children:"Auto-sync on Startup"})]}),e.jsx("p",{className:"text-[10px] text-slate-400 font-medium",children:'Copy the "Secret address in iCal format" from your Google Calendar settings.'})]}),e.jsxs("div",{className:"p-6 rounded-3xl bg-white dark:bg-slate-900 border border-slate-100 dark:border-slate-800 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-4 bg-slate-900 text-white rounded-2xl",children:e.jsx(A,{size:24})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-black text-slate-900 dark:text-white uppercase tracking-wider",children:"Notion Import"}),e.jsx("p",{className:"text-xs text-slate-500 font-bold uppercase tracking-widest",children:"Task Migration"})]})]}),e.jsx("div",{className:`px-4 py-1.5 rounded-full text-[10px] font-black uppercase tracking-widest border transition-all ${m?"bg-green-500/10 text-green-500 border-green-500/20":"bg-slate-500/10 text-slate-500 border-slate-500/20"}`,children:m?"Configured":"Not Connected"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("input",{type:"password",placeholder:"Enter Notion API Token",value:m,onChange:a=>{const s=a.target.value;v(s),g("notion_api_token",s)},className:"w-full bg-slate-50 dark:bg-slate-800 border border-slate-100 dark:border-slate-700 rounded-xl px-4 py-2 text-xs outline-none focus:ring-2 focus:ring-primary-500/20"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",placeholder:"Enter Database ID (Optional - imports all items if empty)",value:w,onChange:a=>{const s=a.target.value;S(s),g("notion_database_id",s)},className:"flex-1 bg-slate-50 dark:bg-slate-800 border border-slate-100 dark:border-slate-700 rounded-xl px-4 py-2 text-xs outline-none focus:ring-2 focus:ring-primary-500/20"}),e.jsx("button",{onClick:()=>T("notion"),disabled:t.loading||!m,className:"px-4 py-2 bg-slate-900 dark:bg-slate-700 text-white hover:bg-black rounded-xl text-xs font-black transition-all disabled:opacity-50",children:t.loading&&t.type==="notion"?"...":"TEST"})]})]}),t.type==="notion"&&e.jsx("p",{className:`text-[10px] font-bold ${t.message.includes("Success")?"text-green-500":"text-red-500"}`,children:t.message})]})]})})}),d==="system"&&e.jsxs("div",{className:"space-y-8",children:[e.jsxs(h,{className:"border-2 border-primary-500/20 bg-primary-500/5 backdrop-blur-sm overflow-hidden relative",children:[e.jsx("div",{className:"absolute top-0 right-0 p-8 opacity-5 pointer-events-none",children:e.jsx(_,{size:120})}),e.jsxs("div",{className:"p-2",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"p-3 bg-primary-500 text-white rounded-2xl shadow-lg shadow-primary-500/30",children:e.jsx(N,{size:24})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-black text-slate-900 dark:text-white uppercase tracking-wider",children:"Emergency Data Tools"}),e.jsx("p",{className:"text-xs text-slate-500 font-bold uppercase tracking-widest",children:"Local Database Management"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8 mb-8",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h4",{className:"font-bold text-slate-800 dark:text-slate-200 flex items-center gap-2",children:[e.jsx(q,{size:18,className:"text-primary-500"}),"Export Database"]}),e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400 leading-relaxed",children:"Download a complete snapshot of your StudySync database. Keep this file safe to restore your data on another device."}),e.jsxs("button",{onClick:$,disabled:o,className:"w-full flex items-center justify-center gap-3 px-6 py-4 bg-white dark:bg-slate-800 border-2 border-primary-500/20 hover:border-primary-500 text-primary-600 dark:text-primary-400 font-black rounded-2xl transition-all shadow-sm active:scale-95 disabled:opacity-50",children:[o?e.jsx(R,{className:"animate-spin"}):e.jsx(Q,{size:20}),o?"EXPORTING...":"DOWNLOAD BACKUP"]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h4",{className:"font-bold text-slate-800 dark:text-slate-200 flex items-center gap-2",children:[e.jsx(O,{size:18,className:"text-orange-500"}),"Restore from File"]}),e.jsxs("p",{className:"text-sm text-slate-500 dark:text-slate-400 leading-relaxed",children:["Upload a previously exported JSON backup to restore your workspace.",e.jsx("span",{className:"text-orange-500 font-bold",children:" This will overwrite all current data."})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"file",accept:".json",onChange:M,className:"absolute inset-0 opacity-0 cursor-pointer z-10",disabled:c}),e.jsxs("div",{className:"flex items-center justify-center gap-3 px-6 py-4 bg-orange-500/10 border-2 border-orange-500/20 hover:border-orange-500 text-orange-600 dark:text-orange-400 font-black rounded-2xl transition-all shadow-sm active:scale-95",children:[c?e.jsx(R,{className:"animate-spin"}):e.jsx(O,{size:20}),c?"IMPORTING...":"UPLOAD & RESTORE"]})]})]})]}),e.jsx(D,{mode:"wait",children:y==="success"&&e.jsxs(E.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0},className:"p-4 bg-green-500/20 border border-green-500/30 text-green-600 dark:text-green-400 rounded-xl flex items-center gap-3 font-bold",children:[e.jsx(_,{size:20}),"Database restored! Reloading application..."]})})]})]}),e.jsxs(h,{className:"border-2 border-green-500/20 bg-green-500/5 backdrop-blur-sm overflow-hidden",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[e.jsx("div",{className:"p-3 rounded-2xl bg-green-500 text-white",children:e.jsx(I,{size:24})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-black text-slate-900 dark:text-white uppercase tracking-wider",children:"Cloud Sync Status"}),e.jsx("p",{className:"text-xs font-bold uppercase tracking-widest text-green-600",children:"CONNECTED TO SUPABASE"})]})]}),e.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400 px-1 font-medium",children:"Your data is now permanently synchronized with the cloud."})]})]})]},d)})]})})};export{ie as default};
