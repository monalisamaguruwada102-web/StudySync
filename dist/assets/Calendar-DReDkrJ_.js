import{r as x,R as K,j as e}from"./vendor-BHBgCXd7.js";import{L as Q}from"./Layout-B83BWzRM.js";import{B as g}from"./Button-Cg-uFP-H.js";import{I as C}from"./Input-Bxxkotjn.js";import{M as X}from"./Modal-DoZe7KXC.js";import{u as f}from"./useFirestore-BslRrM8B.js";import{b as $,m as Z,d as R,s as ee,t as te}from"./index-Bt0XpbVC.js";import{Y as se,j as ae,R as re,P as ne,r as le}from"./icons-BEGX_Ie2.js";import{t as D,c as Y}from"./toDate-BKXxHYqX.js";import{n as de,f as M}from"./format-DmV111vt.js";import{i as p,a as oe}from"./isSameDay-CoaMFuQU.js";import{s as ie}from"./startOfWeek-Bny05VrO.js";import{e as ce}from"./endOfWeek-B_3EXgRf.js";import{p as b}from"./parseISO-DLiBcAvN.js";import"./startOfDay-jrD5UjnC.js";function _(r,n,a){const l=D(r,a?.in);if(isNaN(n))return Y(r,NaN);if(!n)return l;const c=l.getDate(),o=Y(r,l.getTime());o.setMonth(l.getMonth()+n+1,0);const v=o.getDate();return c>=v?o:(l.setFullYear(o.getFullYear(),o.getMonth(),c),l)}function me(r,n){const a=D(r,n?.in),l=a.getMonth();return a.setFullYear(a.getFullYear(),l+1,0),a.setHours(23,59,59,999),a}function ue(r,n){const a=D(r,n?.in);return a.setDate(1),a.setHours(0,0,0,0),a}function xe(r,n,a){const[l,c]=de(a?.in,r,n);return l.getFullYear()===c.getFullYear()&&l.getMonth()===c.getMonth()}function pe(r,n,a){return _(r,-1,a)}const Ee=()=>{const[r,n]=x.useState(new Date),[a,l]=x.useState(new Date),[c,o]=x.useState(!1),{data:v,refresh:z}=f(R.getAll),{data:L}=f(ee.getAll),{data:A}=f(te.getAll),{data:P}=f(Z.getAll),[q,H]=x.useState([]),[T,E]=x.useState(!1),F=async()=>{try{const m=(await $.get("/user/settings")).data.calendar_sync_url;if(!m)return;E(!0);const y=await $.post("/sync/calendar",{url:m});H(y.data)}catch(s){console.error("Failed to sync external calendar:",s)}finally{E(!1)}};K.useEffect(()=>{F()},[]);const[d,u]=x.useState({title:"",moduleId:"",startTime:"09:00",endTime:"10:00",description:""}),W=()=>e.jsxs("div",{className:"flex flex-col md:flex-row items-start md:items-center justify-between mb-8 gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-slate-900 dark:text-slate-100",children:M(r,"MMMM yyyy")}),e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400",children:"Schedule your study sessions and track progress."})]}),e.jsxs("div",{className:"flex items-center gap-2 sm:gap-4 w-full md:w-auto overflow-x-auto pb-2 md:pb-0",children:[e.jsxs("div",{className:"flex bg-white dark:bg-slate-800 border border-slate-100 dark:border-slate-700 rounded-xl overflow-hidden shadow-sm shrink-0",children:[e.jsx("button",{onClick:()=>n(pe(r)),className:"p-2 hover:bg-slate-50 dark:hover:bg-slate-700 transition-colors",children:e.jsx(se,{size:20,className:"text-slate-600 dark:text-slate-400"})}),e.jsx("button",{onClick:()=>n(new Date),className:"px-4 py-2 text-xs font-bold uppercase tracking-wider text-primary-600 dark:text-primary-400 hover:bg-slate-50 dark:hover:bg-slate-700 transition-colors border-x border-slate-100 dark:border-slate-700",children:"Today"}),e.jsx("button",{onClick:()=>n(_(r,1)),className:"p-2 hover:bg-slate-50 dark:hover:bg-slate-700 transition-colors",children:e.jsx(ae,{size:20,className:"text-slate-600 dark:text-slate-400"})})]}),e.jsxs(g,{variant:"secondary",onClick:F,disabled:T,className:"flex items-center gap-2 border-slate-200 dark:border-slate-800 shrink-0",children:[e.jsx(re,{size:18,className:T?"animate-spin":""}),e.jsx("span",{className:"hidden sm:inline",children:"Sync Cloud"})]}),e.jsxs(g,{onClick:()=>o(!0),className:"flex items-center gap-2 whitespace-nowrap shrink-0",children:[e.jsx(ne,{size:20}),e.jsx("span",{children:"Schedule"})]})]})]}),B=()=>{const s=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];return e.jsx("div",{className:"grid grid-cols-7 mb-2",children:s.map(m=>e.jsx("div",{className:"text-center text-[10px] uppercase font-black text-slate-400 tracking-widest",children:m},m))})},U=()=>{const s=ue(r),m=me(s),y=ie(s),G=ce(m),O=[];let j=[],i=y;for(;i<=G;){for(let I=0;I<7;I++){const J=M(i,"d"),h=i,k=L.filter(t=>p(b(t.date),h)),N=A.filter(t=>t.dueDate&&p(b(t.dueDate),h)),w=v.filter(t=>t.date&&p(b(t.date),h)),S=q.filter(t=>p(b(t.start),h));k.length>0||N.length>0||w.length>0||S.length>0,j.push(e.jsxs("div",{className:`min-h-[80px] md:min-h-[120px] p-1 md:p-2 border border-slate-50 dark:border-slate-800 transition-all cursor-pointer hover:bg-slate-50 dark:hover:bg-slate-800/50 ${xe(i,s)?"":"bg-slate-50/50 dark:bg-slate-900/30 opacity-30 pointer-events-none"} ${p(i,new Date)?"bg-primary-50/30 dark:bg-primary-900/10":""}`,onClick:()=>l(h),children:[e.jsx("div",{className:"flex justify-between items-start mb-1 md:mb-2",children:e.jsx("span",{className:`text-xs md:text-sm font-bold ${p(i,new Date)?"bg-primary-600 text-white w-5 h-5 md:w-6 md:h-6 rounded-full flex items-center justify-center":"text-slate-700 dark:text-slate-300"}`,children:J})}),e.jsxs("div",{className:"flex gap-1 md:hidden flex-wrap",children:[k.map(t=>e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-green-500"},t.id)),N.map(t=>e.jsx("div",{className:`w-1.5 h-1.5 rounded-full ${t.status==="Completed"?"bg-slate-400":"bg-orange-500"}`},t.id)),w.map(t=>e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-primary-500"},t.id)),S.map(t=>e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-indigo-500 shadow-sm"},t.id))]}),e.jsxs("div",{className:"hidden md:block space-y-1",children:[k.map(t=>e.jsxs("div",{className:"text-[10px] p-1 bg-green-100 dark:bg-green-900/20 text-green-700 dark:text-green-400 rounded border border-green-200 dark:border-green-800 truncate",title:`Log: ${t.topic}`,children:["ðŸ“š ",t.hours,"h: ",t.topic]},t.id)),N.map(t=>e.jsxs("div",{className:`text-[10px] p-1 rounded border truncate ${t.status==="Completed"?"bg-slate-100 text-slate-400 border-slate-200":"bg-orange-100 dark:bg-orange-900/20 text-orange-700 dark:text-orange-400 border-orange-200 dark:border-orange-800"}`,title:`Task: ${t.title}`,children:["âœ… ",t.title]},t.id)),w.map(t=>e.jsxs("div",{className:"text-[10px] p-1 bg-primary-100 dark:bg-primary-900/20 text-primary-700 dark:text-primary-400 rounded border border-primary-200 dark:border-primary-800 truncate",title:`Event: ${t.title}`,children:["â° ",t.startTime,": ",t.title]},t.id)),S.map(t=>e.jsxs("div",{className:"text-[10px] p-1 bg-indigo-50 dark:bg-indigo-950/30 text-indigo-600 dark:text-indigo-400 rounded border border-indigo-100 dark:border-indigo-900/50 truncate flex items-center gap-1 font-medium",title:`Cloud: ${t.title}`,children:[e.jsx(le,{size:10,className:"shrink-0"})," ",t.title]},t.id))]})]},i)),i=oe(i,1)}O.push(e.jsx("div",{className:"grid grid-cols-7",children:j},i)),j=[]}return e.jsx("div",{className:"bg-white dark:bg-slate-900 rounded-3xl overflow-hidden border border-slate-100 dark:border-slate-800 shadow-sm",children:O})},V=async s=>{s.preventDefault(),await R.add({...d,date:a.toISOString()}),await z(),o(!1),u({title:"",moduleId:"",startTime:"09:00",endTime:"10:00",description:""})};return e.jsxs(Q,{title:"Visual Study Calendar",children:[W(),B(),U(),e.jsx(X,{isOpen:c,onClose:()=>o(!1),title:`Schedule Session for ${M(a,"PP")}`,footer:e.jsxs(e.Fragment,{children:[e.jsx(g,{variant:"secondary",onClick:()=>o(!1),children:"Cancel"}),e.jsx(g,{variant:"primary",onClick:V,children:"Schedule Session"})]}),children:e.jsxs("form",{className:"space-y-4",children:[e.jsx(C,{label:"Session Title",placeholder:"e.g. Exam Prep: Unit 3",value:d.title,onChange:s=>u({...d,title:s.target.value}),required:!0}),e.jsxs("div",{className:"flex flex-col gap-1.5",children:[e.jsx("label",{className:"text-sm font-medium text-slate-700 dark:text-slate-300",children:"Module"}),e.jsxs("select",{className:"px-4 py-2 bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-lg outline-none focus:ring-2 focus:ring-primary-500/20 focus:border-primary-500 dark:text-slate-100",value:d.moduleId,onChange:s=>u({...d,moduleId:s.target.value}),required:!0,children:[e.jsx("option",{value:"",children:"Select a module"}),P.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(C,{label:"Start Time",type:"time",value:d.startTime,onChange:s=>u({...d,startTime:s.target.value}),required:!0}),e.jsx(C,{label:"End Time",type:"time",value:d.endTime,onChange:s=>u({...d,endTime:s.target.value}),required:!0})]}),e.jsxs("div",{className:"flex flex-col gap-1.5",children:[e.jsx("label",{className:"text-sm font-medium text-slate-700 dark:text-slate-300",children:"Notes / Objectives"}),e.jsx("textarea",{className:"px-4 py-2 bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-xl outline-none focus:ring-2 focus:ring-primary-500/20 focus:border-primary-500 dark:text-slate-100 min-h-[100px]",value:d.description,onChange:s=>u({...d,description:s.target.value})})]})]})})]})};export{Ee as default};
