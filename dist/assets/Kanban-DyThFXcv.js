import{r as x,j as e}from"./vendor-BHBgCXd7.js";import{L as P}from"./Layout-BW6pkOKI.js";import{B as m}from"./Button-Cg-uFP-H.js";import{I as h}from"./Input-Bxxkotjn.js";import{M as A}from"./Modal-DoZe7KXC.js";import{u as g}from"./useFirestore-BslRrM8B.js";import{u as M,t as i,m as F}from"./index-DJ53ofb6.js";import{P as O,u as f,a0 as $,z as q,q as E,a1 as B}from"./icons-BEGX_Ie2.js";const U=()=>{const{data:c,refresh:n}=g(i.getAll),{data:p}=g(F.getAll),{refreshAuth:b}=M(),[j,o]=x.useState(!1),[k,v]=x.useState("Pending"),[r,l]=x.useState({title:"",moduleId:"",dueDate:"",description:"",subtasks:[]}),y=[{id:"Pending",title:"To Do",color:"border-t-slate-400"},{id:"In Progress",title:"Doing",color:"border-t-primary-500"},{id:"Completed",title:"Done",color:"border-t-green-500"}],N=(s,t)=>{s.dataTransfer.setData("taskId",t)},w=s=>{s.preventDefault()},D=async(s,t)=>{const a=s.dataTransfer.getData("taskId"),d=c.find(u=>u.id===a);d&&d.status!==t&&(await i.update(a,{status:t}),await n(),await b())},C=async s=>{s.preventDefault(),await i.add({...r,status:k,subtasks:r.subtasks||[]}),await n(),await b(),o(!1),l({title:"",moduleId:"",dueDate:"",description:"",subtasks:[]})},T=async(s,t)=>{const a=[...s.subtasks||[]];a[t].completed=!a[t].completed,await i.update(s.id,{subtasks:a}),await n()},S=()=>{l({...r,subtasks:[...r.subtasks||[],{title:"",completed:!1}]})},I=(s,t)=>{const a=[...r.subtasks];a[s].title=t,l({...r,subtasks:a})},z=async s=>{window.confirm("Delete this task?")&&(await i.delete(s),await n())};return e.jsxs(P,{title:"Project Kanban",children:[e.jsxs("div",{className:"flex justify-between items-center mb-8",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-slate-900 dark:text-slate-100",children:"Task Management"}),e.jsx("p",{className:"text-slate-500 dark:text-slate-400",children:"Organize your IT projects with drag & drop efficiency."})]}),e.jsxs(m,{onClick:()=>{v("Pending"),o(!0)},className:"flex items-center gap-2",children:[e.jsx(O,{size:20}),e.jsx("span",{children:"New Task"})]})]}),e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4 h-[calc(100vh-250px)]",children:y.map(s=>e.jsxs("div",{className:`flex flex-col bg-slate-50 dark:bg-slate-900/50 rounded-3xl border-2 border-dashed border-slate-200 dark:border-slate-800 p-3 ${s.color} border-t-4`,onDragOver:w,onDrop:t=>D(t,s.id),children:[e.jsxs("div",{className:"flex items-center justify-between mb-4 px-2",children:[e.jsx("h3",{className:"font-bold text-slate-700 dark:text-slate-300 uppercase tracking-wider text-xs",children:s.title}),e.jsx("span",{className:"bg-white dark:bg-slate-800 px-2 py-0.5 rounded-full text-[10px] font-bold text-slate-400 shadow-sm",children:c.filter(t=>t.status===s.id).length})]}),e.jsx("div",{className:"flex-1 overflow-y-auto no-scrollbar space-y-3",children:c.filter(t=>t.status===s.id).map(t=>e.jsxs("div",{draggable:!0,onDragStart:a=>N(a,t.id),className:"bg-white dark:bg-slate-800 p-3 rounded-2xl shadow-sm border border-slate-100 dark:border-slate-700 group cursor-grab active:cursor-grabbing hover:border-primary-300 dark:hover:border-primary-500 transition-all",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsx("div",{className:"flex items-center gap-2 text-[10px] font-bold text-primary-500 uppercase tracking-widest bg-primary-50 dark:bg-primary-900/20 px-2 py-0.5 rounded",children:p.find(a=>a.id===t.moduleId)?.name?.split(" ")[0]||"Task"}),e.jsx("button",{onClick:()=>z(t.id),className:"text-slate-300 hover:text-red-500 opacity-0 group-hover:opacity-100 transition-all",children:e.jsx(f,{size:14})})]}),e.jsx("h4",{className:`text-sm font-bold text-slate-800 dark:text-slate-100 mb-2 ${t.status==="Completed"?"line-through opacity-50":""}`,children:t.title}),t.subtasks&&t.subtasks.length>0&&e.jsxs("div",{className:"mt-3 space-y-1.5 p-2 bg-slate-50 dark:bg-slate-900/50 rounded-xl",children:[t.subtasks.map((a,d)=>e.jsxs("div",{className:"flex items-center gap-2 text-[10px]",onClick:u=>{u.stopPropagation(),T(t,d)},children:[a.completed?e.jsx($,{size:12,className:"text-green-500"}):e.jsx(q,{size:12,className:"text-slate-300"}),e.jsx("span",{className:`dark:text-slate-400 ${a.completed?"line-through opacity-50":"text-slate-600"}`,children:a.title})]},d)),e.jsx("div",{className:"h-1 w-full bg-slate-200 dark:bg-slate-700 rounded-full mt-2",children:e.jsx("div",{className:"h-full bg-primary-500 rounded-full",style:{width:`${t.subtasks.filter(a=>a.completed).length/t.subtasks.length*100}%`}})})]}),e.jsxs("div",{className:"flex items-center justify-between mt-4 text-[10px] text-slate-400 font-medium",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(E,{size:12}),e.jsx("span",{children:t.dueDate})]}),e.jsx(B,{size:12,className:"text-slate-200 group-hover:text-slate-400 transition-colors"})]})]},t.id))})]},s.id))}),e.jsx(A,{isOpen:j,onClose:()=>o(!1),title:"Create Advanced Task",footer:e.jsxs(e.Fragment,{children:[e.jsx(m,{variant:"secondary",onClick:()=>o(!1),children:"Cancel"}),e.jsx(m,{variant:"primary",onClick:C,children:"Create Task"})]}),children:e.jsxs("form",{className:"space-y-4",children:[e.jsx(h,{label:"Task Title",value:r.title,onChange:s=>l({...r,title:s.target.value}),required:!0}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"flex flex-col gap-1.5",children:[e.jsx("label",{className:"text-sm font-medium text-slate-700 dark:text-slate-300",children:"Module"}),e.jsxs("select",{className:"px-4 py-2 bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-lg outline-none focus:ring-2 focus:ring-primary-500/20 focus:border-primary-500 dark:text-slate-100",value:r.moduleId,onChange:s=>l({...r,moduleId:s.target.value}),required:!0,children:[e.jsx("option",{value:"",children:"Select a module"}),p.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})]}),e.jsx(h,{label:"Due Date",type:"date",value:r.dueDate,onChange:s=>l({...r,dueDate:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("label",{className:"text-sm font-medium text-slate-700 dark:text-slate-300",children:"Sub-tasks (Nesting)"}),e.jsx("button",{type:"button",onClick:S,className:"text-xs text-primary-600 font-bold hover:underline",children:"+ Add"})]}),r.subtasks.map((s,t)=>e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{className:"flex-1 px-3 py-1.5 bg-slate-50 dark:bg-slate-800 border border-slate-100 dark:border-slate-800 rounded-lg text-xs outline-none focus:border-primary-500 dark:text-slate-100",placeholder:"Enter sub-task step...",value:s.title,onChange:a=>I(t,a.target.value)}),e.jsx("button",{type:"button",onClick:()=>{const a=[...r.subtasks];a.splice(t,1),l({...r,subtasks:a})},className:"text-slate-400 hover:text-red-500",children:e.jsx(f,{size:14})})]},t))]})]})})]})};export{U as default};
