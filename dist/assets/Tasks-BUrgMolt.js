import{r as x,j as e}from"./vendor-BHBgCXd7.js";import{L as S}from"./Layout-B83BWzRM.js";import{C as z}from"./Card-FPDh96Dz.js";import{B as l}from"./Button-Cg-uFP-H.js";import{I as h}from"./Input-Bxxkotjn.js";import{M as T}from"./Modal-DoZe7KXC.js";import{u as g}from"./useFirestore-BslRrM8B.js";import{b as j,t as c,m as A}from"./index-Bt0XpbVC.js";import{w as P,x as O,P as M,y as N,z as B,E as F,q as _,C as $,u as q}from"./icons-BEGX_Ie2.js";import{t as b}from"./toDate-BKXxHYqX.js";import{s as E}from"./startOfDay-jrD5UjnC.js";import{p as L}from"./parseISO-DLiBcAvN.js";function G(o,m){return+b(o)<+b(m)}const te=()=>{const{data:o,loading:m,refresh:i}=g(c.getAll),{data:u}=g(A.getAll),[v,n]=x.useState(!1),[a,d]=x.useState({title:"",moduleId:"",dueDate:"",status:"Pending"}),[p,f]=x.useState(!1),y=async()=>{let t=null,s=null;try{const r=await j.get("/user/settings");t=r.data.notion_api_token,s=r.data.notion_database_id}catch{console.error("Failed to fetch Notion settings from cloud")}if(!t){alert("Please configure your Notion API Token in Settings > Integrations first.");return}f(!0);try{const r=await j.post("/sync/notion-tasks",{token:t,databaseId:s});await i(),alert(r.data.message||"Notion tasks imported successfully!")}catch(r){console.error("Notion import error:",r),alert("Failed to import tasks from Notion.")}finally{f(!1)}},C=async t=>{t.preventDefault(),await c.add(a),await i(),n(!1),d({title:"",moduleId:"",dueDate:"",status:"Pending"})},k=async t=>{const s=t.status==="Completed"?"Pending":"Completed";await c.update(t.id,{status:s}),await i()},w=async t=>{window.confirm("Delete this task?")&&(await c.delete(t),await i())},D=t=>u.find(s=>s.id===t)?.name||"General",I=(t,s)=>s==="Completed"||!t?!1:G(L(t),E(new Date));return e.jsxs(S,{title:"Task Tracker",children:[e.jsxs("div",{className:"flex justify-between items-center mb-8",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-slate-900 dark:text-slate-100",children:"Tasks & Assignments"}),e.jsx("p",{className:"text-slate-500 dark:text-slate-400",children:"Stay on top of your deadlines and deliverables."})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(l,{variant:"secondary",onClick:y,disabled:p,className:"flex items-center gap-2 border-slate-200 dark:border-slate-800",children:[p?e.jsx(P,{size:20,className:"animate-spin"}):e.jsx(O,{size:20}),e.jsx("span",{children:"Import from Notion"})]}),e.jsxs(l,{onClick:()=>n(!0),className:"flex items-center gap-2",children:[e.jsx(M,{size:20}),e.jsx("span",{children:"New Task"})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[o.map(t=>{const s=I(t.dueDate,t.status);return e.jsx(z,{className:`!p-4 border-l-4 transition-all ${t.status==="Completed"?"border-l-green-500 opacity-75":s?"border-l-red-500 bg-red-50/10 dark:bg-red-900/10":"border-l-primary-500"}`,children:e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-start gap-4 flex-1",children:[e.jsx("button",{onClick:()=>k(t),className:`mt-1 transition-colors ${t.status==="Completed"?"text-green-500":"text-slate-300 hover:text-primary-500"}`,children:t.status==="Completed"?e.jsx(N,{size:22,fill:"currentColor",className:"text-white bg-green-500 rounded-full"}):e.jsx(B,{size:22})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:`font-semibold text-slate-800 dark:text-slate-200 ${t.status==="Completed"?"line-through text-slate-400 dark:text-slate-500":""}`,children:t.title}),e.jsxs("div",{className:"flex flex-wrap items-center gap-x-4 gap-y-1 mt-1",children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-xs text-slate-500 dark:text-slate-400",children:[e.jsx(F,{size:12}),e.jsx("span",{children:D(t.moduleId)})]}),e.jsxs("div",{className:`flex items-center gap-1.5 text-xs font-medium ${s?"text-red-500 dark:text-red-400":"text-slate-500 dark:text-slate-400"}`,children:[e.jsx(_,{size:12}),e.jsxs("span",{children:["Due: ",t.dueDate||"No date"]}),s&&e.jsxs("span",{className:"flex items-center gap-1 bg-red-100 px-1.5 py-0.5 rounded text-[10px] uppercase font-bold",children:[e.jsx($,{size:10})," Overdue"]})]})]})]})]}),e.jsx(l,{variant:"ghost",onClick:()=>w(t.id),className:"!p-2 text-slate-400 hover:text-red-500",children:e.jsx(q,{size:16})})]})},t.id)}),o.length===0&&!m&&e.jsxs("div",{className:"text-center py-12 bg-slate-50 rounded-2xl border-2 border-dashed border-slate-200",children:[e.jsx(N,{size:40,className:"mx-auto text-slate-300 mb-3"}),e.jsx("p",{className:"text-slate-500 font-medium",children:"All caught up!"}),e.jsx("p",{className:"text-slate-400 text-sm",children:"You have no pending tasks to display."})]})]}),e.jsx(T,{isOpen:v,onClose:()=>n(!1),title:"Add New Task",footer:e.jsxs(e.Fragment,{children:[e.jsx(l,{variant:"secondary",onClick:()=>n(!1),children:"Cancel"}),e.jsx(l,{variant:"primary",onClick:C,children:"Create Task"})]}),children:e.jsxs("form",{className:"space-y-4",children:[e.jsx(h,{label:"Task Title",placeholder:"e.g. Complete Project Implementation",value:a.title,onChange:t=>d({...a,title:t.target.value}),required:!0}),e.jsxs("div",{className:"flex flex-col gap-1.5",children:[e.jsx("label",{className:"text-sm font-medium text-slate-700",children:"Associated Module"}),e.jsxs("select",{className:"px-4 py-2 bg-slate-50 border border-slate-200 rounded-lg outline-none focus:ring-2 focus:ring-primary-500/20 focus:border-primary-500",value:a.moduleId,onChange:t=>d({...a,moduleId:t.target.value}),required:!0,children:[e.jsx("option",{value:"",children:"Select a module"}),u.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})]}),e.jsx(h,{label:"Due Date",type:"date",value:a.dueDate,onChange:t=>d({...a,dueDate:t.target.value})})]})})]})};export{te as default};
