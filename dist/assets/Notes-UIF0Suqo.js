import{r,j as e,m as de}from"./vendor-BHBgCXd7.js";import{L as ce}from"./Layout-B83BWzRM.js";import{C as ue}from"./Card-FPDh96Dz.js";import{B as d}from"./Button-Cg-uFP-H.js";import{I as V}from"./Input-Bxxkotjn.js";import{M as T}from"./Modal-DoZe7KXC.js";import{y as xe,I as pe,o as me,P as he,E as fe,J as ge,W as be,u as je,K as ye,N as G,O as ve,Q as P,v as M,V as ke}from"./icons-BEGX_Ie2.js";import{u as Y}from"./useFirestore-BslRrM8B.js";import{n as O,m as Ne}from"./index-Bt0XpbVC.js";import{a as W}from"./aiService-DALbnsgD.js";import{s as A}from"./supabase-uzWqJ4bo.js";import"./supabase-mS0VgZ5y.js";const we=({isOpen:w,onClose:C,quizData:l,noteTitle:S})=>{const[o,b]=r.useState(0),[p,i]=r.useState(0),[j,m]=r.useState(!1),[h,y]=r.useState(null),[u,x]=r.useState(!1),z=N=>{u||y(N)},E=()=>{x(!0),h===l[o].correctIndex&&i(p+1)},I=()=>{y(null),x(!1),o<l.length-1?b(o+1):m(!0)},v=()=>{b(0),i(0),m(!1),y(null),x(!1)};return l?e.jsx(T,{isOpen:w,onClose:()=>{v(),C()},title:`Quiz: ${S}`,size:"lg",children:e.jsx("div",{className:"p-2",children:j?e.jsxs("div",{className:"text-center space-y-6 py-10",children:[e.jsx(de.div,{initial:{scale:0},animate:{scale:1},className:"w-24 h-24 bg-yellow-100 dark:bg-yellow-900/30 rounded-full flex items-center justify-center mx-auto text-yellow-500",children:e.jsx(me,{size:48})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-3xl font-bold text-slate-900 dark:text-white mb-2",children:"Quiz Complete!"}),e.jsx("p",{className:"text-slate-500 dark:text-slate-400",children:"You scored"}),e.jsxs("div",{className:"text-5xl font-black text-primary-600 dark:text-primary-400 my-4",children:[p," ",e.jsxs("span",{className:"text-2xl text-slate-400 font-normal",children:["/ ",l.length]})]})]}),e.jsxs("div",{className:"flex justify-center gap-4",children:[e.jsx(d,{variant:"secondary",onClick:()=>{v(),C()},children:"Close"}),e.jsx(d,{onClick:v,children:"Retake Quiz"})]})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center text-sm text-slate-500 dark:text-slate-400",children:[e.jsxs("span",{children:["Question ",o+1," of ",l.length]}),e.jsxs("span",{className:"font-bold text-primary-500",children:["Score: ",p]})]}),e.jsx("div",{className:"w-full h-2 bg-slate-100 dark:bg-slate-800 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-primary-500 transition-all duration-300",style:{width:`${(o+1)/l.length*100}%`}})}),e.jsx("h3",{className:"text-xl font-bold text-slate-800 dark:text-slate-100",children:l[o].question}),e.jsx("div",{className:"space-y-3",children:l[o].options.map((N,c)=>{let f="w-full p-4 rounded-xl border-2 text-left transition-all font-medium flex justify-between items-center ";return u?c===l[o].correctIndex?f+="border-green-500 bg-green-50 dark:bg-green-900/20 text-green-700 dark:text-green-300":c===h?f+="border-red-500 bg-red-50 dark:bg-red-900/20 text-red-700 dark:text-red-300":f+="border-slate-200 dark:border-slate-700 opacity-50":h===c?f+="border-primary-500 bg-primary-50 dark:bg-primary-900/20 text-primary-700 dark:text-primary-300":f+="border-slate-200 dark:border-slate-700 hover:border-primary-300 hover:bg-slate-50 dark:hover:bg-slate-800",e.jsxs("button",{onClick:()=>z(c),className:f,disabled:u,children:[e.jsx("span",{children:N}),u&&c===l[o].correctIndex&&e.jsx(xe,{size:20,className:"text-green-500"}),u&&c===h&&c!==l[o].correctIndex&&e.jsx(pe,{size:20,className:"text-red-500"})]},c)})}),e.jsx("div",{className:"pt-4 flex justify-end",children:u?e.jsx(d,{onClick:I,className:"w-full md:w-auto",children:o<l.length-1?"Next Question":"View Results"}):e.jsx(d,{onClick:E,disabled:h===null,className:"w-full md:w-auto",children:"Check Answer"})})]})})}):null},Fe=()=>{const{data:w,loading:C,refresh:l}=Y(O.getAll),{data:S}=Y(Ne.getAll),[o,b]=r.useState(!1),p=t=>{const s=/^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|&v=)([^#&?]*).*/,a=t?.match(s);return a&&a[2].length===11?a[2]:null},[i,j]=r.useState({title:"",moduleId:"",content:"",resourceLink:"",pdfPath:""}),[m,h]=r.useState(null),[y,u]=r.useState(!1),[x,z]=r.useState(!1),[E,I]=r.useState([]),[v,N]=r.useState(1),[c,f]=r.useState(null),[Ce,Se]=r.useState([]),H=50*1024*1024,J=async()=>{if(x)c.stop(),z(!1);else{if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia){alert("Audio recording is not supported in this browser.");return}try{const t=await navigator.mediaDevices.getUserMedia({audio:!0}),s=new MediaRecorder(t),a=[];s.ondataavailable=n=>{if(a.push(n.data),a.reduce((g,k)=>g+k.size,0)>=H){console.log(`Episode ${v} reached 50MB, auto-saving...`),s.stop();const g=new Blob(a,{type:"audio/webm"});$(g,v),a.length=0,N(k=>k+1),setTimeout(()=>{x&&s.start()},100)}},s.onstop=async()=>{if(a.length>0){const n=new Blob(a,{type:"audio/webm"});await $(n,v)}t.getTracks().forEach(n=>n.stop())},s.start(1e3),f(s),z(!0)}catch(t){console.error("Error accessing microphone:",t),alert("Could not access microphone. Please check permissions.")}}},$=async(t,s)=>{try{const a=`voice_note_ep${s}_${Date.now()}.webm`,{data:n,error:L}=await A.storage.from("notes-files").upload(a,t);if(L)throw L;const{data:{publicUrl:g}}=A.storage.from("notes-files").getPublicUrl(a);I(k=>[...k,{episode:s,url:g}])}catch(a){console.error(`Error uploading episode ${s}:`,a),alert(`Failed to upload episode ${s}`)}},[X,Q]=r.useState(!1),[R,K]=r.useState(""),[F,U]=r.useState(null),[Z,q]=r.useState(null),[ee,te]=r.useState(""),[se,D]=r.useState(!1),[_,B]=r.useState(null),ae=async t=>{t.preventDefault(),u(!0);try{let s="";if(m){const n=`pdf_${Date.now()}_${m.name}`,{data:L,error:g}=await A.storage.from("notes-files").upload(n,m);if(g)throw g;const{data:{publicUrl:k}}=A.storage.from("notes-files").getPublicUrl(n);s=k}const a={...i,moduleId:i.moduleId||null,pdfPath:s,audioEpisodes:E.length>0?E:null};await O.add(a),await l(),b(!1),j({title:"",moduleId:"",content:"",resourceLink:"",pdfPath:""}),h(null),I([]),N(1)}catch(s){alert("Error: "+s.message)}finally{u(!1)}},re=async t=>{window.confirm("Delete this note?")&&(await O.delete(t),await l())},le=t=>S.find(s=>s.id===t)?.name||"General",oe=t=>{const s=t.replace(/```(javascript|js|html|css)?/g,"").replace(/```/g,"");K(s.trim()),Q(!0)},ie=async t=>{U(t.id);try{const s=await W.summarize(t.content),a=t.content+`

`+s;await O.update(t.id,{content:a}),await l()}catch(s){console.error("AI Summarization failed:",s),alert("AI Assistant is currently unavailable.")}finally{U(null)}},ne=async t=>{B(t.id);try{const s=await W.generateQuiz(t.content);q(s),te(t.title),D(!0)}catch{alert("Failed to generate quiz. AI Service unavailable.")}finally{B(null)}};return e.jsxs(ce,{title:"Notes & Resources",children:[e.jsxs("div",{className:"flex justify-between items-center mb-8",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-slate-900 dark:text-slate-100",children:"Personal Notes"}),e.jsx("p",{className:"text-slate-500 dark:text-slate-400",children:"Capture key concepts and link important resources."})]}),e.jsxs(d,{onClick:()=>b(!0),className:"flex items-center gap-2",children:[e.jsx(he,{size:20}),e.jsx("span",{children:"Add Note"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6",children:[w.map(t=>e.jsxs(ue,{className:"flex flex-col h-full hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2 px-2 py-1 bg-slate-100 dark:bg-slate-800 rounded text-[10px] uppercase font-bold text-slate-500 dark:text-slate-400",children:[e.jsx(fe,{size:10}),e.jsx("span",{children:le(t.moduleId)})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(d,{variant:"ghost",onClick:()=>ne(t),className:`!p-1.5 ${_===t.id?"text-purple-500 animate-spin":"text-slate-400 hover:text-purple-500"}`,disabled:_!==null,title:"Generate AI Quiz",children:e.jsx(ge,{size:14})}),e.jsx(d,{variant:"ghost",onClick:()=>ie(t),className:`!p-1.5 ${F===t.id?"text-primary-500 animate-pulse":"text-slate-400 hover:text-primary-500"}`,disabled:F!==null,title:"AI Summarize",children:e.jsx(be,{size:14})}),e.jsx(d,{variant:"ghost",onClick:()=>re(t.id),className:"!p-1.5 text-slate-400 hover:text-red-500",children:e.jsx(je,{size:14})})]})]}),e.jsxs("h3",{className:"font-bold text-slate-800 dark:text-slate-100 mb-2 flex items-center gap-2",children:[e.jsx(ye,{size:18,className:"text-primary-500"}),t.title]}),p(t.resourceLink)&&e.jsx("div",{className:"mb-4 aspect-video rounded-xl overflow-hidden border border-slate-100 dark:border-slate-800",children:e.jsx("iframe",{className:"w-full h-full",src:`https://www.youtube.com/embed/${p(t.resourceLink)}`,title:"YouTube video player",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0})}),e.jsx("div",{className:"flex-1",children:t.content.includes("```")||t.content.includes("{")?e.jsxs("div",{className:"relative group/code",children:[e.jsx("pre",{className:"text-[11px] font-mono bg-slate-900 text-slate-100 p-3 rounded-xl overflow-x-auto border border-slate-700",children:e.jsx("code",{children:t.content})}),e.jsxs("button",{onClick:s=>{s.stopPropagation(),oe(t.content)},className:"absolute top-2 right-2 p-1.5 bg-primary-600 hover:bg-primary-700 text-white rounded-lg opacity-0 group-hover/code:opacity-100 transition-all flex items-center gap-1.5 text-[10px] font-bold",children:[e.jsx(G,{size:10,fill:"currentColor"}),"RUN"]})]}):e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400 whitespace-pre-wrap line-clamp-6",children:t.content})}),t.resourceLink&&e.jsxs("a",{href:t.resourceLink,target:"_blank",rel:"noopener noreferrer",className:"mt-4 flex items-center gap-2 text-primary-600 text-xs font-semibold hover:underline",children:[p(t.resourceLink)?e.jsx(G,{size:12}):e.jsx(ve,{size:12}),p(t.resourceLink)?"Watch Tutorial":"Linked Resource"]}),t.audioEpisodes&&t.audioEpisodes.length>0&&e.jsxs("div",{className:"mt-3 pt-3 border-t border-slate-100 dark:border-slate-800",children:[e.jsxs("p",{className:"text-[10px] font-bold text-slate-400 uppercase tracking-wider mb-2 flex items-center gap-1",children:[e.jsx(P,{size:10})," Voice Notes (",t.audioEpisodes.length," ",t.audioEpisodes.length===1?"Episode":"Episodes",")"]}),e.jsx("div",{className:"space-y-2",children:t.audioEpisodes.map((s,a)=>e.jsxs("div",{className:"bg-slate-50 dark:bg-slate-800/50 p-2 rounded-lg",children:[e.jsxs("p",{className:"text-[9px] text-slate-500 dark:text-slate-400 mb-1 font-medium",children:["Episode ",s.episode||a+1]}),e.jsx("audio",{controls:!0,preload:"metadata",src:s.url,className:"w-full h-7",onError:n=>{console.error("Audio playback error:",n),n.target.style.opacity="0.5"},controlsList:"nodownload"})]},a))})]}),t.audioPath&&!t.audioEpisodes&&e.jsxs("div",{className:"mt-3 pt-3 border-t border-slate-100 dark:border-slate-800",children:[e.jsxs("p",{className:"text-[10px] font-bold text-slate-400 uppercase tracking-wider mb-1 flex items-center gap-1",children:[e.jsx(P,{size:10})," Voice Note"]}),e.jsx("audio",{controls:!0,preload:"metadata",src:t.audioPath,className:"w-full h-8",onError:s=>{console.error("Audio playback error:",s),s.target.style.opacity="0.5"},controlsList:"nodownload"})]}),t.pdfPath&&e.jsxs("a",{href:t.pdfPath,target:"_blank",rel:"noopener noreferrer",className:"mt-2 w-full flex items-center justify-center gap-2 text-blue-600 text-xs font-bold bg-blue-50 dark:bg-blue-900/20 p-2 rounded-lg hover:bg-blue-100 transition-colors",children:[e.jsx(M,{size:14}),e.jsx("span",{children:"View PDF Document"})]})]},t.id)),w.length===0&&!C&&e.jsxs("div",{className:"col-span-full text-center py-20 bg-slate-50 rounded-2xl border-2 border-dashed border-slate-200",children:[e.jsx(M,{size:48,className:"mx-auto text-slate-300 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-slate-600",children:"Your notes are empty"}),e.jsx("p",{className:"text-slate-400",children:"Save important snippets and links here."})]})]}),e.jsx(T,{isOpen:o,onClose:()=>b(!1),title:"Create Note",footer:e.jsxs(e.Fragment,{children:[e.jsx(d,{variant:"secondary",onClick:()=>b(!1),disabled:y,children:"Cancel"}),e.jsx(d,{variant:"primary",onClick:ae,disabled:y,children:y?"Uploading...":"Save Note"})]}),children:e.jsxs("form",{className:"space-y-4",children:[e.jsx(V,{label:"Title",placeholder:"e.g. SQL Optimization Tips",value:i.title,onChange:t=>j({...i,title:t.target.value}),required:!0}),e.jsxs("div",{className:"flex flex-col gap-1.5",children:[e.jsx("label",{className:"text-sm font-medium text-slate-700 dark:text-slate-300",children:"Module (Optional)"}),e.jsxs("select",{className:"px-4 py-2 bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-lg outline-none focus:ring-2 focus:ring-primary-500/20 focus:border-primary-500 dark:text-slate-100",value:i.moduleId,onChange:t=>j({...i,moduleId:t.target.value}),children:[e.jsx("option",{value:"",children:"No Module (General)"}),S.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})]}),e.jsxs("div",{className:"flex flex-col gap-1.5",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("label",{className:"text-sm font-medium text-slate-700 dark:text-slate-300",children:"Content"}),e.jsxs("button",{type:"button",onClick:J,className:`flex items-center gap-1.5 px-3 py-1.5 rounded-lg text-xs font-bold transition-all ${x?"bg-red-500 text-white animate-pulse":"bg-slate-100 dark:bg-slate-700 text-slate-600 dark:text-slate-300 hover:bg-slate-200 dark:hover:bg-slate-600"}`,children:[x?e.jsx(ke,{size:14}):e.jsx(P,{size:14}),x?"Stop Recording":"Record Voice Note"]})]}),e.jsx("textarea",{className:"px-4 py-2 bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-lg outline-none focus:ring-2 focus:ring-primary-500/20 focus:border-primary-500 dark:text-slate-100 min-h-[120px]",placeholder:"Enter your notes or code here...",value:i.content,onChange:t=>j({...i,content:t.target.value}),required:!0})]}),e.jsx(V,{label:"Resource URL (Optional)",type:"url",placeholder:"https://...",value:i.resourceLink,onChange:t=>j({...i,resourceLink:t.target.value})}),e.jsxs("div",{className:"flex flex-col gap-1.5",children:[e.jsx("label",{className:"text-sm font-medium text-slate-700 dark:text-slate-300",children:"Attach PDF (Optional)"}),e.jsxs("div",{className:"relative group",children:[e.jsx("input",{type:"file",accept:".pdf",onChange:t=>h(t.target.files[0]),className:"hidden",id:"pdf-upload"}),e.jsxs("label",{htmlFor:"pdf-upload",className:"flex items-center justify-center gap-2 px-4 py-3 bg-slate-50 dark:bg-slate-800 border-2 border-dashed border-slate-200 dark:border-slate-700 rounded-xl cursor-pointer hover:border-primary-500 hover:bg-primary-50/10 transition-all",children:[e.jsx(M,{size:20,className:"text-slate-400"}),e.jsx("span",{className:"text-sm text-slate-500 dark:text-slate-400",children:m?m.name:"Choose PDF file"})]})]})]})]})}),e.jsx(T,{isOpen:X,onClose:()=>Q(!1),title:"Live Code Sandbox",size:"lg",footer:e.jsx(d,{onClick:()=>Q(!1),children:"Close Sandbox"}),children:e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("label",{className:"text-xs font-bold text-slate-400 uppercase tracking-widest",children:"Execution Output"}),e.jsx("div",{className:"w-full h-[400px] bg-white border border-slate-200 dark:border-slate-700 rounded-2xl overflow-hidden shadow-inner",children:e.jsx("iframe",{title:"Sandbox Output",className:"w-full h-full",srcDoc:`
                                    <!DOCTYPE html>
                                    <html>
                                        <head>
                                            <style>
                                                body { font-family: sans-serif; padding: 20px; color: #334155; }
                                                h1, h2 { color: #4f46e5; }
                                                pre { background: #f8fafc; padding: 10px; border-radius: 8px; }
                                            </style>
                                        </head>
                                        <body>
                                            <div id="app"></div>
                                            <script>
                                                try {
                                                    const consoleLog = console.log;
                                                    console.log = (...args) => {
                                                        const el = document.createElement('pre');
                                                        el.textContent = args.map(a => typeof a === 'object' ? JSON.stringify(a, null, 2) : a).join(' ');
                                                        document.body.appendChild(el);
                                                        consoleLog(...args);
                                                    };
                                                    
                                                    // Wrap user code in a function to allow variables
                                                    (function() {
                                                        ${R.includes("<")?"document.body.innerHTML = `"+R+"`;":R}
                                                    })();
                                                } catch (err) {
                                                    document.body.innerHTML += '<pre style="color: #ef4444; border-color: #fca5a5; background: #fef2f2;">Error: ' + err.message + '</pre>';
                                                }
                                            <\/script>
                                        </body>
                                    </html>
                                `})})]})})}),e.jsx(we,{isOpen:se,onClose:()=>D(!1),quizData:Z,noteTitle:ee})]})};export{Fe as default};
