import{r as a,j as e,m as D,u as qe}from"./vendor-BHBgCXd7.js";import{b as j}from"./index-Bt0XpbVC.js";import{s as A}from"./supabase-uzWqJ4bo.js";import{C as ve}from"./Card-FPDh96Dz.js";import{B as b}from"./Button-Cg-uFP-H.js";import{I as J}from"./Input-Bxxkotjn.js";import{M as Y}from"./Modal-DoZe7KXC.js";import{v as Q,B as X,at as K,as as we,ax as V,e as Fe,ag as _,P as ye,i as ae,a2 as Ne,a6 as ke,_ as Ce,ah as Pe,aG as Be,O as re,N as Ve}from"./icons-BEGX_Ie2.js";import{c as le}from"./toDate-BKXxHYqX.js";import{i as Se,a as _e}from"./isSameDay-CoaMFuQU.js";import{f as te}from"./format-DmV111vt.js";import"./supabase-mS0VgZ5y.js";import"./startOfDay-jrD5UjnC.js";import"./startOfWeek-Bny05VrO.js";function ze(r){return le(r,Date.now())}function Ye(r,d){return Se(le(r,r),ze(r))}function He(r,d,t){return _e(r,-1,t)}function Qe(r,d){return Se(le(r,r),He(ze(r)))}const Xe=()=>{const[r,d]=a.useState([]),[t,u]=a.useState([]),[m,v]=a.useState(null),[R,E]=a.useState(!1),[k,N]=a.useState(null),[I,C]=a.useState(new Set),[q,S]=a.useState(new Set),[T,F]=a.useState([]),f=a.useRef({}),x=a.useCallback(async()=>{try{const n=await j.get("/conversations");d(n.data)}catch(n){console.error("Error fetching conversations:",n),N(n.message)}},[]),$=a.useCallback(async()=>{try{const n=await j.get("/groups");F(n.data)}catch(n){console.error("Error fetching groups:",n)}},[]),z=a.useCallback(async n=>{try{await j.post(`/conversations/${n}/read`),u(l=>l.map(i=>({...i,read:!0})))}catch(l){console.error("Error marking as read:",l)}},[]),c=a.useCallback(async n=>{if(n)try{const l=await j.get(`/messages/${n}`);u(l.data),z(n)}catch(l){console.error("Error fetching messages:",l),N(l.message)}finally{E(!1)}},[z]),p=a.useCallback(async(n,l,i="text",h=null)=>{try{const g=JSON.parse(localStorage.getItem("user")||"{}"),y={conversationId:n,content:l,type:i,sharedResource:h,senderId:g.id,senderEmail:g.email,timestamp:new Date().toISOString(),read:!1,status:"sent"},w=await j.post("/messages",y);return u(ee=>[...ee,w.data]),x(),w.data}catch(g){throw console.error("Error sending message:",g),N(g.message),g}},[x]),G=a.useCallback(async(n,l)=>{if(!A||!n)return;const i=A.channel(`chat:${n}`),h=JSON.parse(localStorage.getItem("user")||"{}");await i.track({user:h.email,typing:l}),i.send({type:"broadcast",event:"typing",payload:{userId:h.id,isTyping:l}})},[]),U=a.useCallback(async n=>{try{const l=await j.post("/conversations/direct",{otherUserId:n});return await x(),l.data}catch(l){throw console.error("Error creating conversation:",l),N(l.message),l}},[x]),W=a.useCallback(async(n,l)=>{const i=`Shared ${l.type}: ${l.title}`;return p(n,i,l.type,l)},[p]),P=a.useCallback(async(n,l)=>{try{const i=await j.post("/groups/create",{name:n,description:l});return await x(),i.data}catch(i){throw console.error("Error creating group:",i),N(i.message),i}},[x]),Z=a.useCallback(async n=>{try{const l=await j.post(`/groups/join/${n}`,{});return await x(),l.data}catch(l){throw console.error("Error joining group:",l),N(l.message),l}},[x]),B=a.useCallback(async(n,l)=>{try{const i=await j.post(`/conversations/${n}/respond`,{status:l});return await x(),i.data}catch(i){throw console.error("Error responding to request:",i),N(i.message),i}},[x]);return a.useEffect(()=>{"Notification"in window&&Notification.permission==="default"&&Notification.requestPermission()},[]),a.useEffect(()=>{if(!m)return;const n=setInterval(()=>{c(m.id)},3e3);return()=>clearInterval(n)},[m,c]),a.useEffect(()=>{if(!m||!A)return;const n=A.channel(`chat:${m.id}`);return n.on("broadcast",{event:"typing"},({payload:l})=>{const{userId:i,isTyping:h}=l,g=JSON.parse(localStorage.getItem("user")||"{}");i!==g.id&&(h?(S(y=>new Set(y).add(i)),f.current[i]&&clearTimeout(f.current[i]),f.current[i]=setTimeout(()=>{S(y=>{const w=new Set(y);return w.delete(i),w})},3e3)):S(y=>{const w=new Set(y);return w.delete(i),w}))}).on("postgres_changes",{event:"INSERT",schema:"public",table:"messages",filter:`conversation_id=eq.${m.id}`},l=>{const i=l.new;u(h=>h.some(g=>g.id===i.id)?h:[...h,i]),document.hidden&&Notification.permission==="granted"&&new Notification("New Message",{body:i.content,icon:"/favicon.ico"})}).subscribe(),()=>{n.unsubscribe()}},[m]),a.useEffect(()=>{if(!A)return;const n=A.channel("global_presence"),l=JSON.parse(localStorage.getItem("user")||"{}");return n.on("presence",{event:"sync"},()=>{const i=n.presenceState(),h=new Set;Object.values(i).forEach(g=>{g.forEach(y=>{y.userId&&h.add(y.userId)})}),C(h)}).subscribe(async i=>{i==="SUBSCRIBED"&&await n.track({userId:l.id,onlineAt:new Date().toISOString()})}),()=>{n.unsubscribe()}},[]),a.useEffect(()=>{x()},[x]),{conversations:r,messages:t,activeConversation:m,setActiveConversation:v,loading:R,error:k,sendMessage:p,createDirectConversation:U,shareResource:W,createGroup:P,joinGroup:Z,refreshConversations:x,onlineUsers:I,typingUsers:q,sendTyping:G,respondToRequest:B,availableGroups:T,fetchAvailableGroups:$}},Ke=({isOpen:r,onClose:d,onShare:t})=>{const[u,m]=a.useState("notes"),[v,R]=a.useState([]),[E,k]=a.useState([]),[N,I]=a.useState([]),[C,q]=a.useState(""),[S,T]=a.useState(!1);a.useEffect(()=>{if(!r)return;(async()=>{T(!0);try{const[p,G,U]=await Promise.all([j.get("/notes"),j.get("/flashcardDecks"),j.get("/tutorials")]);R(p.data),k(G.data),I(U.data)}catch(p){console.error("Error fetching resources:",p)}finally{T(!1)}})()},[r]);const F=(c,p)=>{const G={type:p,resourceId:c.id,title:c.title||c.name,preview:c.content?.substring(0,100)||c.description?.substring(0,100)||""};t(G),d()},f=c=>C?c.filter(p=>(p.title||p.name||"").toLowerCase().includes(C.toLowerCase())):c,x=[{id:"notes",label:"Notes",icon:Q,data:v},{id:"flashcards",label:"Flashcards",icon:X,data:E},{id:"tutorials",label:"Tutorials",icon:K,data:N}],$=x.find(c=>c.id===u)?.data||[],z=f($);return e.jsx(Y,{isOpen:r,onClose:d,title:"Share Resource",size:"large",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex gap-2 border-b border-slate-200 dark:border-slate-700",children:x.map(c=>{const p=c.icon;return e.jsxs("button",{onClick:()=>m(c.id),className:`flex items-center gap-2 px-4 py-2 font-medium transition-all ${u===c.id?"text-blue-600 dark:text-blue-400 border-b-2 border-blue-600 dark:border-blue-400":"text-slate-600 dark:text-slate-400 hover:text-slate-800 dark:hover:text-slate-200"}`,children:[e.jsx(p,{size:16}),c.label,e.jsx("span",{className:"text-xs bg-slate-100 dark:bg-slate-800 px-2 py-0.5 rounded-full",children:c.data.length})]},c.id)})}),e.jsx(J,{placeholder:`Search ${u}...`,value:C,onChange:c=>q(c.target.value),icon:we}),e.jsx("div",{className:"max-h-96 overflow-y-auto space-y-2",children:S?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-blue-600"})}):z.length===0?e.jsxs("div",{className:"text-center py-12 text-slate-500",children:[e.jsxs("p",{children:["No ",u," found"]}),C&&e.jsx("p",{className:"text-sm mt-1",children:"Try a different search term"})]}):z.map(c=>e.jsx(We,{resource:c,type:u,onShare:()=>F(c,u.slice(0,-1))},c.id))})]})})},We=({resource:r,type:d,onShare:t})=>{const u=()=>{switch(d){case"notes":return e.jsx(Q,{size:16,className:"text-teal-500"});case"flashcards":return e.jsx(X,{size:16,className:"text-fuchsia-500"});case"tutorials":return e.jsx(K,{size:16,className:"text-red-500"});default:return null}},m=()=>{if(d==="notes")return r.content?.substring(0,80)||"No content";if(d==="flashcards"){const v=r.cards?.length||0;return`${v} card${v!==1?"s":""}`}else if(d==="tutorials")return r.topic||r.description?.substring(0,80)||"No description";return""};return e.jsx(D.div,{whileHover:{scale:1.01},className:"p-3 bg-slate-50 dark:bg-slate-800 rounded-lg border border-slate-200 dark:border-slate-700 hover:border-blue-300 dark:hover:border-blue-700 transition-all cursor-pointer",onClick:t,children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[u(),e.jsx("h4",{className:"font-semibold text-sm text-slate-800 dark:text-slate-100 truncate",children:r.title||r.name})]}),e.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400 line-clamp-2",children:m()})]}),e.jsx(b,{onClick:v=>{v.stopPropagation(),t()},variant:"primary",className:"text-xs px-3 py-1 flex-shrink-0",children:"Share"})]})})},Ze=({message:r,isOwn:d,handleOpenResource:t,formatTime:u})=>e.jsx(D.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:`flex ${d?"justify-end":"justify-start"}`,children:e.jsxs("div",{className:`max-w-[75%] ${d?"items-end":"items-start"} flex flex-col gap-1`,children:[e.jsx("div",{className:"flex items-center gap-2 px-1",children:!d&&e.jsx("span",{className:"text-[10px] font-medium text-slate-500 uppercase tracking-wider",children:r.senderEmail.split("@")[0]})}),e.jsx("div",{className:`px-4 py-2.5 rounded-2xl shadow-sm ${d?"bg-gradient-to-br from-blue-500 to-blue-600 text-white rounded-tr-none border border-blue-400/20":"bg-white dark:bg-slate-800 text-slate-800 dark:text-slate-100 rounded-tl-none border border-slate-200/50 dark:border-slate-700/50 backdrop-blur-sm shadow-slate-200/50 dark:shadow-none"}`,children:r.sharedResource?e.jsx(es,{resource:r.sharedResource,onClick:()=>t(r.sharedResource)}):e.jsx("p",{className:"text-[13px] leading-relaxed break-words",children:r.content})}),e.jsxs("div",{className:"flex items-center gap-1 mt-0.5 px-1",children:[e.jsx("span",{className:"text-[9px] text-slate-400 font-medium uppercase tracking-tighter",children:u(r.timestamp)}),d&&e.jsx("span",{className:"text-slate-400",children:r.read?e.jsx(Be,{size:12,className:"text-blue-500"}):e.jsx(ae,{size:12})})]})]})}),es=({resource:r,onClick:d})=>{const u=(m=>{switch(m){case"note":return{icon:e.jsx(Q,{size:14}),color:"border-emerald-500 text-emerald-600 dark:text-emerald-400 bg-emerald-50/50 dark:bg-emerald-900/10"};case"flashcard":return{icon:e.jsx(X,{size:14}),color:"border-purple-500 text-purple-600 dark:text-purple-400 bg-purple-50/50 dark:bg-purple-900/10"};case"tutorial":return{icon:e.jsx(K,{size:14}),color:"border-rose-500 text-rose-600 dark:text-rose-400 bg-rose-50/50 dark:bg-rose-900/10"};default:return{icon:e.jsx(ke,{size:14}),color:"border-slate-500 text-slate-600"}}})(r.type);return e.jsxs(D.div,{whileHover:{y:-2},className:`bg-white dark:bg-slate-900/90 p-3 rounded-xl border-l-4 ${u.color} shadow-sm min-w-[200px] cursor-pointer group`,onClick:d,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-1.5 px-2 py-0.5 rounded-full bg-white dark:bg-slate-800 border border-slate-100 dark:border-slate-700",children:[u.icon,e.jsx("span",{className:"text-[9px] font-bold uppercase tracking-wider",children:r.type})]}),e.jsx(re,{size:12,className:"text-slate-400 opacity-0 group-hover:opacity-100 transition-opacity"})]}),e.jsx("div",{className:"font-bold text-slate-800 dark:text-slate-100 text-xs mb-1 line-clamp-1",children:r.title}),r.preview&&e.jsx("div",{className:"text-[10px] text-slate-500 dark:text-slate-400 line-clamp-2 leading-relaxed",children:r.preview})]})},ss=({isOpen:r,onClose:d,resource:t,loading:u,onNavigate:m})=>{if(!r)return null;const v=R=>{const E=/^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|&v=)([^#&?]*).*/,k=R?.match(E);return k&&k[2].length===11?k[2]:null};return e.jsx(Y,{isOpen:r,onClose:d,title:t?`Viewing ${t.type}: ${t.title||t.name}`:"Loading...",size:"lg",children:e.jsx("div",{className:"min-h-[300px] max-h-[60vh] overflow-y-auto",children:u?e.jsxs("div",{className:"flex flex-col items-center justify-center h-48 space-y-4",children:[e.jsx("div",{className:"animate-spin rounded-full h-10 w-10 border-t-2 border-b-2 border-blue-500"}),e.jsx("p",{className:"text-slate-500 text-sm",children:"Fetching resource details..."})]}):t?e.jsxs("div",{className:"space-y-6 p-2",children:[t.type==="note"&&e.jsxs("div",{className:"space-y-4 text-slate-800 dark:text-slate-200",children:[e.jsx("p",{className:"text-sm border-l-4 border-emerald-500 pl-4 py-1 bg-emerald-50/50 dark:bg-emerald-900/10 rounded-r-lg",children:t.content||"No content provided."}),t.pdfPath&&e.jsxs("a",{href:t.pdfPath,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2 text-blue-600 dark:text-blue-400 font-bold bg-blue-50 dark:bg-blue-900/20 p-3 rounded-xl hover:bg-blue-100 transition-colors",children:[e.jsx(Q,{size:18}),e.jsx("span",{children:"View Attached PDF Document"})]}),e.jsxs(b,{variant:"secondary",className:"w-full h-12 rounded-xl flex items-center justify-center gap-2",onClick:()=>m("/notes"),children:[e.jsx(re,{size:18}),e.jsx("span",{children:"Open in Notes Manager"})]})]}),t.type==="tutorial"&&e.jsxs("div",{className:"space-y-4",children:[v(t.url)?e.jsx("div",{className:"aspect-video rounded-3xl overflow-hidden border border-slate-200 dark:border-slate-800 shadow-xl",children:e.jsx("iframe",{className:"w-full h-full",src:`https://www.youtube.com/embed/${v(t.url)}`,title:"YouTube video player",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0})}):e.jsxs("div",{className:"p-12 text-center bg-slate-50 dark:bg-slate-800/50 rounded-3xl border-2 border-dashed border-slate-200 dark:border-slate-700",children:[e.jsx(K,{size:48,className:"mx-auto text-slate-300 mb-4"}),e.jsx("p",{className:"text-slate-500",children:"This tutorial is a direct link."})]}),e.jsxs(b,{variant:"primary",className:"w-full h-12 rounded-xl flex items-center justify-center gap-2",onClick:()=>window.open(t.url,"_blank"),children:[e.jsx(re,{size:18}),e.jsx("span",{children:"Open Resource Link"})]})]}),t.type==="flashcard"&&e.jsxs("div",{className:"space-y-6 py-4",children:[e.jsxs("div",{className:"text-center p-8 bg-purple-50 dark:bg-purple-900/10 rounded-3xl border border-purple-100 dark:border-purple-900/30",children:[e.jsx(X,{size:48,className:"mx-auto text-purple-500 mb-4"}),e.jsx("h3",{className:"text-xl font-bold text-slate-800 dark:text-slate-100 mb-2",children:t.name||t.title}),e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400",children:"Master this deck using Spaced Repetition."})]}),e.jsxs(b,{variant:"primary",className:"w-full h-14 rounded-2xl bg-gradient-to-r from-purple-600 to-indigo-600 flex items-center justify-center gap-2 shadow-lg shadow-purple-500/20",onClick:()=>m("/flashcards"),children:[e.jsx(Ve,{size:20}),e.jsx("span",{className:"text-lg",children:"Start Study Session"})]})]})]}):e.jsxs("div",{className:"text-center py-20",children:[e.jsx(Ce,{size:48,className:"mx-auto text-red-500/50 mb-4"}),e.jsx("p",{className:"text-slate-600 dark:text-slate-400 font-medium",children:"Resource not found."})]})})})},bs=()=>{const{conversations:r,messages:d,activeConversation:t,setActiveConversation:u,sendMessage:m,createDirectConversation:v,shareResource:R,createGroup:E,joinGroup:k,onlineUsers:N,typingUsers:I,sendTyping:C,respondToRequest:q,availableGroups:S,fetchAvailableGroups:T}=Xe();a.useEffect(()=>{f==="groups"&&T()},[f,T]);const F=async s=>{try{await k(s),alert("Successfully joined group!"),x("chats")}catch(o){alert("Failed to join group: "+o.message)}},[f,x]=a.useState("chats"),[$,z]=a.useState(""),[c,p]=a.useState(!1),[G,U]=a.useState(!1),[W,P]=a.useState(!1),[Z,B]=a.useState(!1),[n,l]=a.useState(!1),[i,h]=a.useState(null),[g,y]=a.useState(!1),[w,ee]=a.useState([]),[ne,Re]=a.useState(""),[H,ie]=a.useState(""),[oe,ce]=a.useState(""),[se,de]=a.useState(""),[Ee,ue]=a.useState(!1),xe=a.useRef(null),M=JSON.parse(localStorage.getItem("user")||"{}"),me=M.email==="joshuamujakari15@gmail.com";a.useEffect(()=>{xe.current?.scrollIntoView({behavior:"smooth"})},[d,I]);const Ie=s=>{z(s.target.value),t&&C(t.id,s.target.value.length>0)},Te=async()=>{try{const s=await j.get("/users/all");ee(s.data.filter(o=>o.id!==M.id))}catch(s){console.error("Error fetching users:",s)}};a.useEffect(()=>{c&&Te()},[c]);const pe=async()=>{if(!(!$.trim()||!t))try{await m(t.id,$),z(""),C(t.id,!1)}catch(s){console.error("Error sending message:",s)}},$e=async s=>{try{const o=await v(s);u(o),p(!1)}catch(o){console.error("Error creating conversation:",o)}},Ge=async()=>{if(H.trim())try{const s=await E(H,oe);u(s.conversation),ie(""),ce(""),P(!1),alert(`Group "${H}" created successfully!

Invite Code: ${s.group.inviteCode}

Share this code with your friends so they can join!`)}catch(s){console.error("Error creating group:",s),alert(s.response?.data?.error||"Failed to create group")}},Me=async()=>{if(se.trim())try{await k(se),de(""),B(!1),alert("Successfully joined group!")}catch(s){console.error("Error joining group:",s),alert(s.response?.data?.error||"Failed to join group")}},De=s=>{s&&(navigator.clipboard.writeText(s),ue(!0),setTimeout(()=>ue(!1),2e3))},Ue=qe(),Oe=async s=>{y(!0),l(!0),h(null);try{let o="";switch(s.type){case"note":o=`/notes/${s.resourceId}`;break;case"flashcard":o=`/flashcardDecks/${s.resourceId}`;break;case"tutorial":o=`/tutorials/${s.resourceId}`;break;default:throw new Error("Unknown resource type")}const L=await j.get(o);h({...L.data,type:s.type})}catch(o){console.error("Error fetching resource details:",o),alert("Failed to load resource details. It might have been deleted."),l(!1)}finally{y(!1)}},Le=s=>{if(!s)return"";const o=new Date(s);return te(o,"h:mm a")},Ae=s=>{if(!s)return"";const o=new Date(s);return Ye(o)?te(o,"h:mm a"):Qe(o)?"Yesterday":te(o,"MMM d")},O=s=>{if(s.type==="group")return{title:s.groupName||"Group Chat",status:`${s.participants?.length||0} members`,isOnline:!1};const o=s.otherUser,L=o&&N.has(o.id);return{title:o?.email||"Unknown User",status:L?"Online":"Offline",isOnline:L}},he=w.filter(s=>s.email.toLowerCase().includes(ne.toLowerCase())),be=()=>{if(!t||I.size===0)return null;const s=Array.from(I).filter(o=>t.participants?.includes(o)&&o!==M.id);return s.length===0?null:s.length===1?"Typing...":"Multiple people typing..."},Je=r.filter(s=>!s.status||s.status==="active"||s.status==="pending"&&s.initiatorId===M.id),fe=r.filter(s=>s.status==="pending"&&s.initiatorId!==M.id&&s.type==="direct"),ge=f==="chats"?Je:fe,je=async s=>{if(t)try{await q(t.id,s),s==="rejected"&&u(null)}catch(o){console.error("Error responding:",o)}};return e.jsxs("div",{className:"flex h-[calc(100vh-120px)] gap-4 p-6",children:[e.jsx("div",{className:"w-80 flex flex-col gap-4",children:e.jsxs(ve,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h2",{className:"text-xl font-bold text-slate-800 dark:text-slate-100 flex items-center gap-2",children:[e.jsx(V,{className:"text-blue-500",size:24}),"Chats"]}),e.jsxs("a",{href:"/",className:"flex items-center gap-2 text-slate-400 hover:text-primary-500 transition-colors bg-slate-50 dark:bg-slate-800 px-3 py-1.5 rounded-full border border-slate-200 dark:border-slate-700",children:[e.jsx(Fe,{size:14}),e.jsx("span",{className:"text-[10px] font-bold uppercase tracking-widest",children:"Dash"})]})]}),e.jsxs("div",{className:"flex gap-2 mb-4 bg-slate-100 dark:bg-slate-800 p-1 rounded-xl",children:[e.jsxs("button",{onClick:()=>x("chats"),className:`flex-1 flex items-center justify-center gap-2 py-2 rounded-lg text-sm font-medium transition-all ${f==="chats"?"bg-white dark:bg-slate-700 shadow-sm text-blue-600 dark:text-blue-400":"text-slate-500 dark:text-slate-400 hover:text-slate-700"}`,children:[e.jsx(V,{size:16}),"Chats"]}),e.jsxs("button",{onClick:()=>x("requests"),className:`flex-1 flex items-center justify-center gap-2 py-2 rounded-lg text-sm font-medium transition-all relative ${f==="requests"?"bg-white dark:bg-slate-700 shadow-sm text-blue-600 dark:text-blue-400":"text-slate-500 dark:text-slate-400 hover:text-slate-700"}`,children:[e.jsx(_,{size:16}),"Requests",fe.length>0&&e.jsx("span",{className:"absolute top-1 right-2 w-2 h-2 bg-red-500 rounded-full animate-pulse"})]}),e.jsxs("button",{onClick:()=>x("groups"),className:`flex-1 flex items-center justify-center gap-2 py-2 rounded-lg text-sm font-medium transition-all ${f==="groups"?"bg-white dark:bg-slate-700 shadow-sm text-blue-600 dark:text-blue-400":"text-slate-500 dark:text-slate-400 hover:text-slate-700"}`,children:[e.jsx(_,{size:16}),"Groups"]})]}),f==="chats"&&e.jsxs("div",{className:"flex gap-2 mb-4",children:[e.jsxs(b,{onClick:()=>p(!0),variant:"primary",className:"flex-1 text-sm h-10",children:[e.jsx(ye,{size:16}),"New Chat"]}),e.jsxs(b,{onClick:()=>B(!0),variant:"secondary",className:"flex-1 text-sm h-10",children:[e.jsx(_,{size:16}),"Join Group"]})]}),me&&e.jsxs(b,{onClick:()=>P(!0),variant:"success",className:"w-full mb-4 text-sm",children:[e.jsx(ye,{size:16}),"Create Group"]}),e.jsx("div",{className:"space-y-2 max-h-[calc(100vh-450px)] overflow-y-auto custom-scrollbar",children:f==="groups"?S.length===0?e.jsxs("div",{className:"text-center py-10 opacity-50",children:[e.jsx(_,{size:32,className:"mx-auto mb-2 text-slate-300"}),e.jsx("p",{className:"text-sm text-slate-500",children:"No public groups found."})]}):S.map(s=>e.jsxs(D.div,{layout:!0,initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"p-3 bg-white dark:bg-slate-800 rounded-xl border border-slate-100 dark:border-slate-700 shadow-sm hover:shadow-md transition-all relative overflow-hidden group",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsx("div",{className:"font-semibold text-slate-800 dark:text-slate-100",children:s.name}),e.jsxs("span",{className:"text-[10px] bg-slate-100 dark:bg-slate-700 px-2 py-0.5 rounded-full text-slate-500",children:[s.members?.length||0," members"]})]}),e.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400 line-clamp-2 mb-3",children:s.description||"No description provided."}),e.jsx(b,{onClick:()=>F(s.inviteCode),className:"w-full text-xs h-8 bg-blue-50 text-blue-600 hover:bg-blue-100 dark:bg-blue-900/20 dark:text-blue-400 dark:hover:bg-blue-900/40 border-none",children:"Join Group"})]},s.id)):ge.length===0?e.jsxs("div",{className:"text-center py-10 opacity-50",children:[e.jsx(V,{size:32,className:"mx-auto mb-2 text-slate-300"}),e.jsx("p",{className:"text-sm text-slate-500",children:f==="chats"?"No active chats.":"No pending requests."})]}):ge.map(s=>{const{title:o,isOnline:L}=O(s);return e.jsx(D.div,{layout:!0,initial:{opacity:0,y:10},animate:{opacity:1,y:0},whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>u(s),className:`p-3 rounded-lg cursor-pointer transition-all ${t?.id===s.id?"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800":"bg-slate-50 dark:bg-slate-800 hover:bg-slate-100 dark:hover:bg-slate-700"}`,children:e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"relative",children:[s.type==="group"?e.jsx(_,{size:14,className:"text-blue-500 flex-shrink-0"}):e.jsx(V,{size:14,className:"text-slate-400 flex-shrink-0"}),L&&e.jsx("span",{className:"absolute -top-0.5 -right-0.5 w-2 h-2 bg-emerald-500 rounded-full border border-white dark:border-slate-800"})]}),e.jsx("h3",{className:"font-semibold text-sm text-slate-800 dark:text-slate-100 truncate",children:o})]}),e.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400 truncate mt-1",children:s.lastMessage||"No messages yet"})]}),s.lastMessageTime&&e.jsx("span",{className:"text-[10px] text-slate-400 flex-shrink-0",children:Ae(s.lastMessageTime)})]})},s.id)})})]})}),e.jsx("div",{className:"flex-1 flex flex-col",children:e.jsx(ve,{className:"flex-1 flex flex-col",children:t?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"p-4 border-b border-slate-200 dark:border-slate-700",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h2",{className:"text-lg font-bold text-slate-800 dark:text-slate-100 leading-tight",children:O(t).title}),O(t).isOnline&&e.jsx("span",{className:"w-2.5 h-2.5 bg-emerald-500 rounded-full animate-pulse shadow-sm shadow-emerald-500/50"})]}),t.type==="direct"?e.jsxs("p",{className:"text-xs text-slate-500 flex items-center gap-2",children:[O(t).status,t.otherUser&&e.jsxs("span",{children:["• Level ",t.otherUser.level]})]}):e.jsxs("div",{className:"flex items-center gap-2 mt-0.5",children:[e.jsxs("span",{className:"text-[10px] font-mono bg-slate-100 dark:bg-slate-800 px-1.5 py-0.5 rounded text-slate-600 dark:text-slate-400 uppercase tracking-wider border border-slate-200 dark:border-slate-700",children:["Code: ",t.inviteCode||"..."]}),e.jsx("button",{onClick:()=>De(t.inviteCode),className:"text-blue-500 hover:text-blue-600 transition-colors",title:"Copy Invite Code",children:Ee?e.jsx(ae,{size:12}):e.jsx(Ne,{size:12})})]})]})}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs(b,{onClick:()=>U(!0),variant:"secondary",className:"text-xs h-9 px-3",children:[e.jsx(ke,{size:14}),"Share Resource"]})})]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[d.length===0?e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx("p",{className:"text-slate-500 text-sm",children:"No messages yet. Start the conversation!"})}):d.map((s,o)=>e.jsx(Ze,{message:s,isOwn:s.senderId===M.id,handleOpenResource:Oe,formatTime:Le},s.id||o)),be()&&e.jsxs(D.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"text-xs text-slate-400 italic ml-4 flex items-center gap-1",children:[e.jsx("span",{className:"w-1.5 h-1.5 bg-slate-400 rounded-full animate-bounce"}),e.jsx("span",{className:"w-1.5 h-1.5 bg-slate-400 rounded-full animate-bounce delay-75"}),e.jsx("span",{className:"w-1.5 h-1.5 bg-slate-400 rounded-full animate-bounce delay-150"}),e.jsx("span",{className:"ml-1",children:be()})]}),e.jsx("div",{ref:xe})]}),e.jsx("div",{className:"p-4 border-t border-slate-200 dark:border-slate-700",children:t.status==="pending"&&t.initiatorId!==M.id?e.jsxs("div",{className:"flex flex-col items-center gap-3 p-4 bg-slate-50 dark:bg-slate-800/50 rounded-xl border border-slate-200 dark:border-slate-700",children:[e.jsxs("p",{className:"text-sm text-slate-600 dark:text-slate-300 font-medium",children:[O(t).title," wants to chat with you."]}),e.jsxs("div",{className:"flex gap-3 w-full",children:[e.jsxs(b,{onClick:()=>je("active"),className:"flex-1 bg-emerald-500 hover:bg-emerald-600 text-white border-none",children:[e.jsx(ae,{size:18})," Accept"]}),e.jsxs(b,{onClick:()=>je("rejected"),className:"flex-1 bg-transprent border border-slate-300 hover:bg-slate-100 text-slate-600 dark:text-slate-400",children:[e.jsx(Ce,{size:18})," Decline"]})]})]}):t?.status==="pending"?e.jsx("div",{className:"text-center p-4 bg-slate-50 dark:bg-slate-800/50 rounded-xl border border-slate-200 dark:border-slate-700",children:e.jsxs("p",{className:"text-sm text-slate-500",children:["Waiting for ",O(t).title," to accept your request."]})}):e.jsxs("div",{className:"flex gap-2",children:[t.type==="group"&&t.inviteCode&&e.jsxs("div",{className:"flex-1 flex items-center justify-between px-3 py-2 bg-slate-50 dark:bg-slate-800/50 rounded-lg border border-slate-200 dark:border-slate-700",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs font-semibold text-slate-500 uppercase",children:"Invite Code:"}),e.jsx("code",{className:"text-sm font-mono text-blue-600 dark:text-blue-400 select-all",children:t.inviteCode})]}),e.jsx(b,{title:"Copy Invite Code",onClick:()=>{navigator.clipboard.writeText(t.inviteCode),alert("Invite code copied!")},className:"h-6 w-6 p-0 flex items-center justify-center bg-transparent hover:bg-slate-200 dark:hover:bg-slate-700 text-slate-500",children:e.jsx(Ne,{size:12})})]}),e.jsx(J,{value:$,onChange:Ie,onKeyPress:s=>s.key==="Enter"&&pe(),placeholder:"Type a message...",className:"flex-1 backdrop-blur-sm bg-white/50 dark:bg-slate-900/50"}),e.jsx(b,{onClick:pe,variant:"primary",className:"shadow-lg shadow-blue-500/20",children:e.jsx(Pe,{size:18})})]})})]}):e.jsxs("div",{className:"flex-1 flex items-center justify-center relative overflow-hidden",children:[e.jsxs("div",{className:"absolute inset-0 pointer-events-none opacity-30",children:[e.jsx("div",{className:"absolute top-1/4 left-1/4 w-96 h-96 bg-blue-500/20 rounded-full blur-3xl animate-pulse"}),e.jsx("div",{className:"absolute bottom-1/4 right-1/4 w-64 h-64 bg-purple-500/20 rounded-full blur-3xl animate-pulse delay-700"})]}),e.jsxs("div",{className:"text-center relative z-10 p-8 glass rounded-3xl border border-white/20 shadow-2xl backdrop-blur-md",children:[e.jsx("div",{className:"w-20 h-20 bg-gradient-to-tr from-blue-500 to-purple-500 rounded-2xl mx-auto mb-6 flex items-center justify-center shadow-lg shadow-blue-500/30 transform -rotate-6",children:e.jsx(V,{size:40,className:"text-white"})}),e.jsx("h3",{className:"text-2xl font-bold text-slate-800 dark:text-slate-100 mb-2",children:"StudySync Chat"}),e.jsx("p",{className:"text-slate-500 dark:text-slate-400 max-w-xs mx-auto mb-6",children:"Connect with peers, join study groups, and share your knowledge in real-time."}),e.jsx(b,{onClick:()=>p(!0),variant:"primary",className:"w-full shadow-lg shadow-blue-500/25",children:"Start New Chat"})]})]})})}),e.jsx(Y,{isOpen:c,onClose:()=>p(!1),title:"Start a Conversation",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(J,{placeholder:"Search users...",value:ne,onChange:s=>Re(s.target.value),icon:we}),e.jsx("div",{className:"max-h-96 overflow-y-auto space-y-2",children:w.length===0?e.jsx("div",{className:"text-center py-8 text-slate-500",children:e.jsx("p",{children:"No users found on the server."})}):he.length===0?e.jsx("div",{className:"text-center py-8 text-slate-500",children:e.jsx("p",{children:"No users match your search."})}):he.map(s=>{const o=N.has(s.id);return e.jsx(D.div,{whileHover:{scale:1.02},onClick:()=>$e(s.id),className:"p-3 bg-slate-50 dark:bg-slate-800 rounded-lg cursor-pointer hover:bg-slate-100 dark:hover:bg-slate-700 transition-colors flex items-center justify-between",children:e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium text-slate-800 dark:text-slate-100 flex items-center gap-2",children:[s.email,o&&e.jsx("span",{className:"w-2 h-2 bg-emerald-500 rounded-full"})]}),e.jsxs("div",{className:"text-xs text-slate-500",children:["Level ",s.level," • ",s.xp," XP"]})]})},s.id)})})]})}),me&&e.jsx(Y,{isOpen:W,onClose:()=>P(!1),title:"Create Group",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(J,{placeholder:"Group name",value:H,onChange:s=>ie(s.target.value)}),e.jsx(J,{placeholder:"Description (optional)",value:oe,onChange:s=>ce(s.target.value)}),e.jsx(b,{onClick:Ge,variant:"primary",className:"w-full",children:"Create Group"})]})}),e.jsx(Y,{isOpen:Z,onClose:()=>B(!1),title:"Join Group",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(J,{placeholder:"Enter invite code",value:se,onChange:s=>de(s.target.value.toUpperCase())}),e.jsx(b,{onClick:Me,variant:"primary",className:"w-full",children:"Join Group"})]})}),e.jsx(Ke,{isOpen:G,onClose:()=>U(!1),onShare:async s=>{t&&await R(t.id,s)}}),e.jsx(ss,{isOpen:n,onClose:()=>l(!1),resource:i,loading:g,onNavigate:s=>Ue(s)})]})};export{bs as default};
